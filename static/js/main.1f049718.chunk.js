(this["webpackJsonpautores-demo-client"]=this["webpackJsonpautores-demo-client"]||[]).push([[2],{123:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(27),o=a.n(i),c=a(45),s=a(11),l=a(20),u=a(32),d=a(21),m=a(13);function h(e){return{type:"FAIL_ATTRIBUTE",attribute:e}}function p(e){return{type:"REQUEST_OPTIONS",attribute:e}}function f(e,t){return{type:"RECEIVE_OPTIONS",attribute:e,options:t}}function v(e){return{type:"UNCHOOSE_TAREA",id:e}}function b(e){return{type:"ADD_TAREA",tarea:e}}function E(e){return{type:"SET_CURRRENT_ACTIVIDAD",actividad:e}}function g(e){return{type:"REMOVE_ELEMENT_FROM_EXTRA",element:e}}function C(e){return{type:"REMOVE_VALID_ELEMENT_FROM_EXTRA",element:e}}function k(e){return{type:"REMOVE_BYSCORE_CRITERION",criterion:e}}function y(e,t){return{type:"ADD_SCORE_TO_CRITERION",score:e,criterionName:t}}function O(e){return{type:"REMOVE_SCORE_FROM_CRITERIA",code:e}}function T(e,t){return{type:"ADD_FILE_TO_EXTRA",url:e,filetype:t}}function x(e){return{type:"API_USER_FOUND",auth:e}}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isFetching:!1,didInvalidate:!1,error:!1,items:[]},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FAIL_ATTRIBUTE":return Object(m.a)({},e,{isFetching:!1,error:!0});case"INVALIDATE_ATTRIBUTE":return Object(m.a)({},e,{didInvalidate:!0});case"REQUEST_OPTIONS":return Object(m.a)({},e,{isFetching:!0,didInvalidate:!1});case"RECEIVE_OPTIONS":return Object(m.a)({},e,{isFetching:!1,error:!1,items:t.options,lastUpdated:t.receivedAt});case"ADD_SELECT_OPTION":var a=e.items.findIndex((function(e){return e.nombre===t.option.nombre}));return-1===a?Object(m.a)({},e,{items:[].concat(Object(d.a)(e.items),[t.option])}):e;default:return e}}var S=a(82),A=a(95),_={elements:[],validElements:[],byScore:[]};var I={token:{accessToken:null,expiresAt:null},roles:[],user:{},isLoading:!1};var w=Object(c.b)({oidc:l.reducer,optionsByAttribute:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FAIL_ATTRIBUTE":case"INVALIDATE_ATTRIBUTE":case"RECEIVE_OPTIONS":case"REQUEST_OPTIONS":case"ADD_SELECT_OPTION":return Object.assign({},e,Object(u.a)({},t.attribute,j(e[t.attribute],t)));default:return e}},actividadTareas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{criteria:{autor:"",nombre:"",dominio:""},tareasResult:[],selectedTareaId:"",chosenTareas:[]},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SELECT_TAREA":return Object(m.a)({},e,{selectedTareaId:t.id});case"CHOOSE_TAREA":var a=e.chosenTareas.findIndex((function(t){return t.id===e.selectedTareaId}));if(-1!==a)return e;var n=e.tareasResult.find((function(t){return t.id===e.selectedTareaId}));return Object(m.a)({},e,{chosenTareas:[].concat(Object(d.a)(e.chosenTareas),[n])});case"UNCHOOSE_TAREA":return Object(m.a)({},e,{chosenTareas:e.chosenTareas.filter((function(e){return e.id!==t.id}))});case"ADD_TAREA":var r=e.chosenTareas.findIndex((function(e){return e.nombre===t.tarea.nombre}));return-1!==r?e:Object(m.a)({},e,{chosenTareas:[].concat(Object(d.a)(e.chosenTareas),[t.tarea])});case"SET_RESULT_TAREAS":return Object(m.a)({},e,{resultTareas:t.tareas});default:return e}},actividad:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{currentActividad:{},currentDominioId:""},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CURRRENT_ACTIVIDAD":return Object(m.a)({},e,{currentActividad:t.actividad});default:return e}},tareaExtra:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TAREA_EXTRA":return Object(m.a)({},e,{extra:t.extra});case"CLEAR_TAREA_EXTRA":return _;case"ADD_ELEMENT_TO_EXTRA":var a=e.elements.findIndex((function(e){return e.name===t.element.name}));return-1!==a?e:Object(m.a)({},e,{elements:[].concat(Object(d.a)(e.elements),[t.element])});case"REMOVE_ELEMENT_FROM_EXTRA":return Object(m.a)({},e,{elements:e.elements.filter((function(e){return e.code!==t.element.code})),validElements:e.validElements.filter((function(e){return e!==t.element.code}))});case"ADD_VALID_ELEMENT_TO_EXTRA":var n=e.validElements.findIndex((function(e){return e===t.element}));return-1!==n?e:Object(m.a)({},e,{validElements:[].concat(Object(d.a)(e.validElements),[t.element])});case"REMOVE_VALID_ELEMENT_FROM_EXTRA":return Object(m.a)({},e,{validElements:e.validElements.filter((function(e){return e!==t.element}))});case"ADD_BYSCORE_CRITERION":var r=e.byScore.findIndex((function(e){return e.name===t.criterion.name}));return-1!==r?e:Object(m.a)({},e,{byScore:[].concat(Object(d.a)(e.byScore),[t.criterion])});case"REMOVE_BYSCORE_CRITERION":return Object(m.a)({},e,{byScore:e.byScore.filter((function(e){return e.name!==t.criterion.name}))});case"ADD_SCORE_TO_CRITERION":var i=e.byScore.find((function(e){return e.name===t.criterionName})),o=Object(m.a)({},i,{scores:Object(m.a)({},i.scores,Object(u.a)({},t.score.code,t.score.value))});return Object(m.a)({},e,{byScore:e.byScore.map((function(e){return e.name!==t.criterionName?e:o}))});case"REMOVE_SCORE_FROM_CRITERIA":var c=e.byScore.map((function(e){var a=e.scores,n=t.code,r=(a[n],Object(S.a)(a,[n].map(A.a)));return Object(m.a)({},e,{scores:r})}));return Object(m.a)({},e,{byScore:c});case"ADD_DEPOSIT_TO_ELEMENT":var s=e.elements.find((function(e){return e.code===t.elementCode}));if(s.deposits){var l=s.deposits.findIndex((function(e){return e===t.depositCode}));if(-1!==l)return e}else s.deposits=[];return s.deposits=[].concat(Object(d.a)(s.deposits),[t.depositCode]),Object(m.a)({},e,{elements:e.elements.map((function(e){return e.code!==t.elementCode?e:s}))});case"REMOVE_DEPOSIT_FROM_ELEMENT":var h=e.elements.find((function(e){return e.code===t.elementCode}));return h.deposits=h.deposits.filter((function(e){return e!==t.depositCode})),h.deposits?Object(m.a)({},e,{elements:e.elements.map((function(e){return e.code!==t.elementCode?e:h}))}):e;case"ADD_FILE_TO_EXTRA":return Object(m.a)({},e,{plano:{url:t.url,filetype:t.filetype}});default:return e}},auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"API_USER_FOUND":return Object(m.a)({},e,{token:t.auth.token,roles:t.auth.user.roles,user:{nombre:t.auth.user.nombre,apellido:t.auth.user.apellido,email:t.auth.user.email},isLoading:!1});case"API_USER_EXPIRED":case"API_USER_LOGGED_OUT":return I;case"LOADING_API_USER":return Object(m.a)({},I,{isLoading:!0});default:return e}}}),R=a(55),N={client_id:"43374848214-9up4el9vkf6dhbb6gc5qn2euqggp3c68.apps.googleusercontent.com",redirect_uri:"".concat(window.location.protocol,"//").concat(window.location.hostname).concat(window.location.port?":".concat(window.location.port):"","/callback"),response_type:"token id_token",scope:"openid profile email",authority:"https://accounts.google.com",automaticSilentRenew:!0,silent_redirect_uri:"".concat(window.location.protocol,"//").concat(window.location.hostname).concat(window.location.port?":".concat(window.location.port):"","/silent_renew.html"),filterProtocolClaims:!0,loadUserInfo:!0,userStore:new R.WebStorageStateStore({store:window.localStorage})},P=Object(l.createUserManager)(N),D=a(22),L=a(43),F=a(127),M=function(){return r.a.createElement("div",null,r.a.createElement("h2",null,"No ten\xe9s permiso para ver esta p\xe1gina"))},U=a(133),B=a(125),V=a(126);var z=function(){return r.a.createElement(U.a.Control,{as:B.a,variant:"Light",disabled:!0},r.a.createElement(V.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),"Cargando...")},G=a(4),q=a.n(G),K=a(15),H=a(5),X=a(6),Y=a(8),Q=a(9),J=a(12),W=a(10),Z=a(59),$=a.n(Z),ee={root:{display:"flex",flexDirection:"column",justifyContent:"space-around",alignItems:"center",flexShrink:1}},te=function(e){return r.a.createElement("div",{style:ee.root},r.a.createElement("h3",null,"Bienvienido a AutoresDemo"),r.a.createElement("p",null,"Inici\xe1 sesi\xf3n para continuar"),r.a.createElement(B.a,{onClick:e.onClick,variant:"outline-dark","data-cy":"iniciarSesionButton",role:"button",style:{textTransform:"none"}},r.a.createElement("img",{width:"20px",style:{marginBotton:"3px",marginRight:"5px"},alt:"Google sign-in",src:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Google_%22G%22_Logo.svg/512px-Google_%22G%22_Logo.svg.png"}),"Iniciar sesi\xf3n con Google"),e.error&&r.a.createElement(U.a.Text,{className:"text-danger"},"Ocurri\xf3 un error"))},ae=a(87),ne=a.n(ae);function re(){var e=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return ne()(e)}function ie(e){return Date.now()>e}var oe=a(77),ce=function(){function e(){Object(H.a)(this,e),this._tokenNotFound=new oe.a("Token not found"),this._apiUserFound=new oe.a("Api user found")}return Object(X.a)(e,[{key:"_raiseTokenNotFound",value:function(e){this._tokenNotFound.raise(e)}},{key:"addTokenNotFound",value:function(e){this._tokenNotFound.addHandler(e)}},{key:"removeTokenNotFound",value:function(e){this._tokenNotFound.removeHandler(e)}},{key:"_raiseApiUserFound",value:function(e){this._apiUserFound.raise(e)}},{key:"addApiUserFound",value:function(e){this._apiUserFound.addHandler(e)}},{key:"removeApiUserFound",value:function(e){this._apiUserFound.removeHandler(e)}}]),e}(),se="https://autores-demo-mock-api.herokuapp.com/api/v1.0",le=["5","6","7","8"],ue=["5","6","8"],de=["8","9"],me=[{name:"S\xcd se elige",code:"YES"},{name:"NO se elige",code:"NO"},{name:"S\xcd se pas\xf3 por",code:"YES_TASK"},{name:"NO se pas\xf3 por",code:"NO_TASK"}],he=[{name:"S\xcd se pas\xf3 por",code:"YES_TASK"},{name:"NO se pas\xf3 por",code:"NO_TASK"}],pe=function(){function e(){Object(H.a)(this,e),this._events=new ce}return Object(X.a)(e,[{key:"setToken",value:function(e){this.token=e}},{key:"getToken",value:function(){var e=this.token;if(!e||ie(e.expiresAt)){var t=fe.store.getState();if(t.oidc&&t.oidc.user){var a=fe.store.getState().oidc.user.id_token,n=fe.fetchAuth(a);return n&&n.token&&n.token.accessToken?(this._events._apiUserFound.raise(n),e):(this._events._tokenNotFound.raise(),null)}return this._events._tokenNotFound.raise(),null}return e}},{key:"fetchAuth",value:function(){var e=Object(K.a)(q.a.mark((function e(t){var a,n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchToken(t);case 2:if(a=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,this.authorizedRequest(a,"/me");case 7:return n=e.sent,e.abrupt("return",{token:a,user:n});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchToken",value:function(){var e=Object(K.a)(q.a.mark((function e(t){var a,n,r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://autores-demo-mock-api.herokuapp.com/api/oauth/v2/token",{method:"POST",headers:{"X-AUTH-TOKEN":!0,"Content-Type":"application/json"},body:JSON.stringify({token:t})});case 2:return a=e.sent,e.prev=3,e.next=6,a.json();case 6:if(!(n=e.sent).error_code){e.next=11;break}return e.abrupt("return",null);case 11:return r={accessToken:n.access_token,expiresAt:(i=n.expires_in,Date.now()+1e3*i)},this.token=r,e.abrupt("return",r);case 14:e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(3),e.abrupt("return",null);case 19:case"end":return e.stop()}var i}),e,this,[[3,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"authorizedRequest",value:function(){var e=Object(K.a)(q.a.mark((function e(t,a){var n,r,i,o=arguments;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>2&&void 0!==o[2]?o[2]:{},r=!(o.length>3&&void 0!==o[3])||o[3],!t||!t.accessToken){e.next=19;break}return n.headers={Authorization:"Bearer "+t.accessToken},r&&(n.headers["Content-Type"]="application/json"),e.prev=5,e.next=8,fetch(se+a,n);case 8:return i=e.sent,e.next=11,i.json();case 11:return e.abrupt("return",e.sent);case 14:return e.prev=14,e.t0=e.catch(5),e.abrupt("return",{user_message:"Ocurri\xf3 un error",error_code:0});case 17:e.next=20;break;case 19:return e.abrupt("return",{user_message:"No autorizado",error_code:0});case 20:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"unauthorizedRequest",value:function(){var e=Object(K.a)(q.a.mark((function e(t){var a,n,r=arguments;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,fetch(se+"/public"+t,a);case 3:return n=e.sent,e.next=6,n.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"authorizedGetRequest",value:function(e){var t=this.getToken();return this.authorizedRequest(t,e)}},{key:"authorizedPostRequest",value:function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getToken();return this.authorizedRequest(n,e,{body:a?JSON.stringify(t):t,method:"POST"},a)}},{key:"authorizedPutRequest",value:function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getToken();return this.authorizedRequest(n,e,{body:a?JSON.stringify(t):t,method:"PUT"})}},{key:"authorizedDeleteRequest",value:function(e){var t=this.getToken();return this.authorizedRequest(t,e,{method:"DELETE"})}},{key:"me",value:function(){return this.authorizedGetRequest("/me")}},{key:"getActividadesPublic",value:function(){return this.unauthorizedRequest("/actividades")}},{key:"getActividadPublic",value:function(e){return this.unauthorizedRequest("/actividades/".concat(e))}},{key:"getMisActividades",value:function(){return this.authorizedGetRequest("/actividades/user")}},{key:"getActividad",value:function(e){return this.authorizedGetRequest("/actividades/"+e)}},{key:"getMisTareas",value:function(){return this.authorizedGetRequest("/tareas/user")}},{key:"getTarea",value:function(e){return this.authorizedGetRequest("/tareas/"+e)}},{key:"getTareaPublic",value:function(e){return this.unauthorizedRequest("/tareas/"+e)}},{key:"getTareasPublic",value:function(){return this.unauthorizedRequest("/tareas")}},{key:"getTareasForActividad",value:function(e){return this.authorizedGetRequest("/actividades/"+e+"/tareas")}},{key:"getTareasForActividadPublic",value:function(e){return this.unauthorizedRequest("/actividades/".concat(e,"/tareas"))}},{key:"getPlanificacionForActividad",value:function(e){return this.authorizedGetRequest("/planificaciones/"+e)}},{key:"getPlanificacionForActividadPublic",value:function(e){return this.unauthorizedRequest("/planificaciones/".concat(e))}},{key:"postDominio",value:function(e){return this.authorizedPostRequest("/dominios",e)}},{key:"postActividad",value:function(e){return this.authorizedPostRequest("/actividades",e)}},{key:"postTarea",value:function(e){return this.authorizedPostRequest("/tareas",e)}},{key:"postExtraToTarea",value:function(e,t){return this.authorizedPostRequest("/tareas/"+t+"/extra",e)}},{key:"putTareasToActividad",value:function(e,t){return this.authorizedPutRequest("/actividades/"+t+"/tareas",e)}},{key:"putPlanificacionToActividad",value:function(e,t){return this.authorizedPutRequest("/planificaciones/"+t,e)}},{key:"postFilePlanoToTarea",value:function(e,t){return this.authorizedPostRequest("/tareas/"+t+"/plano",e,!1)}},{key:"deleteSaltosFromActividad",value:function(e){return this.authorizedDeleteRequest("/actividades/"+e+"/saltos")}},{key:"deleteTareasFromActividad",value:function(e){return this.authorizedDeleteRequest("/actividades/"+e+"/tareas")}}]),e}(),fe=function(){function e(){Object(H.a)(this,e)}return Object(X.a)(e,null,[{key:"initialize",value:function(t){var a=this;this.store=t,this.client=new pe,this.client._events._tokenNotFound.addHandler((function(){a.store.dispatch(Object(l.userSignedOut)())})),this.client._events._apiUserFound.addHandler((function(t){a.store.dispatch(x(t)),e.storeApiUser(t.token)}))}},{key:"removeApiUser",value:function(){localStorage.removeItem("auth.token")}},{key:"delay",value:function(){var e=Object(K.a)(q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,setTimeout(1);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadApiUser",value:function(){var e=Object(K.a)(q.a.mark((function e(){var t,a,n,r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.store.dispatch({type:"LOADING_API_USER"}),t=localStorage.getItem("auth.token"),a=null,t&&(a=JSON.parse(t)),!(a&&a.accessToken&&ie(a.expiresAt))){e.next=23;break}if(!this.store.getState().oidc.isLoadingUser){e.next=23;break}return e.next=9,this.delay();case 9:if(console.log("retry"),this.store.getState().oidc.isLoadingUser){e.next=22;break}if(!this.store.getState().oidc.user){e.next=19;break}return e.next=14,this.fetchAuth(this.store.getState().oidc.user.id_token);case 14:n=e.sent,a=n.token,this.storeApiUser(a),e.next=20;break;case 19:console.log("not logged in");case 20:e.next=23;break;case 22:console.log("still no");case 23:if(!a||!a.accessToken||ie(a.expiresAt)){e.next=37;break}return this.client.setToken(a),e.prev=25,e.next=28,this.client.me();case 28:r=e.sent,this.store.dispatch(x({token:a,user:r})),e.next=35;break;case 32:e.prev=32,e.t0=e.catch(25),this.store.dispatch({type:"API_USER_EXPIRED"});case 35:e.next=38;break;case 37:this.store.dispatch({type:"API_USER_EXPIRED"});case 38:case"end":return e.stop()}}),e,this,[[25,32]])})));return function(){return e.apply(this,arguments)}}()},{key:"storeApiUser",value:function(e){localStorage.setItem("auth.token",JSON.stringify(e)),this.client.setToken(e)}},{key:"fetchAuth",value:function(e){return this.client.fetchAuth(e)}},{key:"authorizedGetRequest",value:function(e){return this.client.authorizedGetRequest(e)}},{key:"publicGetRequest",value:function(e){return this.client.unauthorizedRequest(e)}},{key:"getActividadesPublic",value:function(){return this.client.getActividadesPublic()}},{key:"getActividadPublic",value:function(e){return this.client.getActividadPublic(e)}},{key:"getActividad",value:function(e){return this.client.getActividad(e)}},{key:"getTarea",value:function(e){return this.client.getTarea(e)}},{key:"getTareaPublic",value:function(e){return this.client.getTareaPublic(e)}},{key:"getTareasPublic",value:function(){return this.client.getTareasPublic()}},{key:"getTareasForActividad",value:function(e){return this.client.getTareasForActividad(e)}},{key:"getTareasForActividadPublic",value:function(e){return this.client.getTareasForActividadPublic(e)}},{key:"getPlanificacionForActividad",value:function(e){return this.client.getPlanificacionForActividad(e)}},{key:"getPlanificacionForActividadPublic",value:function(e){return this.client.getPlanificacionForActividadPublic(e)}},{key:"getMisActividades",value:function(){return this.client.getMisActividades()}},{key:"getMisTareas",value:function(){return this.client.getMisTareas()}},{key:"createDominio",value:function(e){return this.client.postDominio(e)}},{key:"createActividad",value:function(e){return this.client.postActividad(e)}},{key:"createTarea",value:function(e){return this.client.postTarea(e)}},{key:"addExtraToTarea",value:function(e,t){return this.client.postExtraToTarea(e,t)}},{key:"addPlanoToTarea",value:function(e,t){return this.client.postFilePlanoToTarea(e,t)}},{key:"setTareasToActividad",value:function(e,t){return this.client.putTareasToActividad(e,t)}},{key:"setPlanificacionInActividad",value:function(e,t){return this.client.putPlanificacionToActividad(e,t)}},{key:"deleteSaltosFromActividad",value:function(e){return this.client.deleteSaltosFromActividad(e)}},{key:"deleteTareasFromActividad",value:function(e){return this.client.deleteTareasFromActividad(e)}}]),e}();fe.store=null;var ve=function(e){function t(){var e;return Object(H.a)(this,t),(e=Object(Y.a)(this,Object(Q.a)(t).call(this))).onLoginButtonClick=e.onLoginButtonClick.bind(Object(J.a)(e)),e}return Object(W.a)(t,e),Object(X.a)(t,[{key:"onLoginButtonClick",value:function(){var e=Object(K.a)(q.a.mark((function e(t){var a;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,fe.fetchAuth(1234);case 3:a=e.sent,this.props.dispatch(x(a)),fe.storeApiUser(a.token),this.props.history.push("/");case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"error",value:function(){var e=$.a.parse(this.props.location.search);return-1!==Object.keys(e).indexOf("error")}},{key:"render",value:function(){return r.a.createElement(te,{onClick:this.onLoginButtonClick,error:this.error()})}}]),t}(r.a.Component);function be(e){return{token:e.auth.token,oidc:e.auth}}var Ee=function(e){return Object(s.b)(be)((function(t){return t.token.isLoading||t.oidc.isLoading?r.a.createElement(z,null):t.token.accessToken?r.a.createElement(e,t):r.a.createElement(ve,t)}))};function ge(e){return{roles:e.auth.roles,isLoading:e.auth.isLoading}}var Ce=a(23),ke=Object(Ce.a)(),ye=a(132),Oe=a(134);var Te=function(e){return r.a.createElement(ye.a,{bg:"light",expand:"lg"},r.a.createElement(ye.a.Brand,{href:"/"},"Autores Demo"),r.a.createElement(ye.a.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(ye.a.Collapse,{id:"basic-navbar-nav"},r.a.createElement(Oe.a,{className:"mr-auto"},r.a.createElement(Oe.a.Link,{href:"/"},"Home"),r.a.createElement(Oe.a.Link,{href:"#/actividad/15"},"Agregar tareas"),r.a.createElement(Oe.a.Link,{href:"#/actividad/15/planificacion"},"Editar planificaci\xf3n"))),r.a.createElement(ye.a.Collapse,{className:"justify-content-end"},e.token.accessToken?r.a.createElement(B.a,{onClick:e.onClickCerrarSesion,"data-cy":"cerrarSesionButton"},"Cerrar sesi\xf3n"):r.a.createElement(r.a.Fragment,null)))},xe=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).onClickCerrarSesion=a.onClickCerrarSesion.bind(Object(J.a)(a)),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"onClickCerrarSesion",value:function(e){e.preventDefault(),P.removeUser(),fe.removeApiUser(),this.props.dispatch({type:"API_USER_LOGGED_OUT"}),ke.push("/")}},{key:"onClickIniciarSesion",value:function(e){e.preventDefault(),P.signinRedirect()}},{key:"render",value:function(){return r.a.createElement(Te,{token:this.props.token,onClickCerrarSesion:this.onClickCerrarSesion,onClickIniciarSesion:this.onClickIniciarSesion})}}]),t}(n.Component);var je=Object(s.b)((function(e){return{user:e.oidc.user,token:e.auth.token}}))(xe);var Se=function(e){var t=e.user;return r.a.createElement("div",null,r.a.createElement("div",null,"Bienvenido, ",t.nombre," ",t.apellido,"!"))};var Ae=Object(s.b)((function(e){return{user:e.auth.user}}))((function(e){var t=e.user;return r.a.createElement(Se,{user:t})})),_e=a(128),Ie=a(86),we=function(e){e.match.params;return r.a.createElement(F.a,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement("h2",null,"P\xe1gina principal"))),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,{style:{border:"1px solid black",padding:"2em"}},r.a.createElement(Ae,null))))},Re=function(e){return r.a.createElement(l.CallbackComponent,{userManager:e.userManager,successCallback:e.successCallback,errorCallback:e.errorCallback},r.a.createElement(z,null))},Ne=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).onError=function(e){a.props.history.push("/"),console.error(e)},a.onSuccess=a.onSuccess.bind(Object(J.a)(a)),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"onSuccess",value:function(){var e=Object(K.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.props.dispatch({type:"LOADING_API_USER"}),e.next=3,fe.fetchAuth(this.props.user.id_token);case 3:(t=e.sent)?(this.props.dispatch(x(t)),fe.storeApiUser(t.token),this.props.history.push("/")):(this.props.dispatch(Object(l.userSignedOut)()),this.props.dispatch({type:"API_USER_LOGGED_OUT"}),this.props.history.push("/?error"));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(Re,{userManager:P,successCallback:this.onSuccess,errorCallback:this.onError})}}]),t}(r.a.Component);var Pe=Object(s.b)((function(e){return{user:e.oidc.user}}))(Ne),De=function(e){e.match.params;var t=e.history;return r.a.createElement(Pe,{history:t})},Le=a(68);var Fe=function(e){return r.a.createElement("div",null,e.horizontal?r.a.createElement(U.a.Group,{as:_e.a,controlId:e.controlId},r.a.createElement(U.a.Label,{column:!0,sm:3},e.label),r.a.createElement(Ie.a,{sm:9},r.a.createElement(U.a.Control,{type:e.type,placeholder:e.placeholder,onChange:e.onChange,onKeyPress:e.onKeyPress,name:e.name,value:e.value,disabled:e.disabled,onBlur:e.onBlur}))):r.a.createElement(U.a.Group,{controlId:e.controlId},e.label&&r.a.createElement(U.a.Label,null,e.label),r.a.createElement(U.a.Control,{type:e.type,placeholder:e.placeholder,onChange:e.onChange,onKeyPress:e.onKeyPress,name:e.name,value:e.value,disabled:e.disabled,onBlur:e.onBlur})))},Me=a(129),Ue=a(85),Be=function(e){return r.a.createElement(Ie.a,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement(Me.a,{className:"mb-3"},r.a.createElement(Ue.a,{type:"text",value:e.dominio,placeholder:"Nuevo dominio",id:"formNewDominio",onChange:e.onChange,onKeyPress:e.onKeyPress}),r.a.createElement(Me.a.Append,null,e.isLoading?r.a.createElement(z,null):r.a.createElement(B.a,{variant:"success",disabled:""===e.dominio,type:"button",onClick:e.onClick},"Agregar"))))),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,e.error&&r.a.createElement(U.a.Text,{className:"text-danger",style:{marginTop:"-1em"}},e.errorMessage))))},Ve=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).state={dominio:"",errorMessage:"",error:!1,isLoading:!1},a.handleChange=a.handleChange.bind(Object(J.a)(a)),a.onClick=a.onClick.bind(Object(J.a)(a)),a.onKeyPress=a.onKeyPress.bind(Object(J.a)(a)),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"handleChange",value:function(e){this.setState({dominio:e.target.value})}},{key:"onClick",value:function(){var e=Object(K.a)(q.a.mark((function e(t){var a;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),this.setState({isLoading:!0,error:!1,errorMessage:""}),e.next=4,fe.createDominio({nombre:this.state.dominio});case 4:(a=e.sent).error_code?this.setState({isLoading:!1,error:!0,errorMessage:a.user_message}):(this.props.dispatch({type:"ADD_SELECT_OPTION",attribute:"dominio",option:a}),this.setState({dominio:"",isLoading:!1,error:!1,errorMessage:""}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onKeyPress",value:function(e){"Enter"===e.key&&""!==this.state.dominio&&this.onClick(e)}},{key:"render",value:function(){return r.a.createElement(Be,{dominio:this.state.dominio,onChange:this.handleChange,onKeyPress:this.onKeyPress,isLoading:this.state.isLoading,onClick:this.onClick,error:this.state.error,errorMessage:this.state.errorMessage})}}]),t}(n.Component);var ze=Object(s.b)((function(e){return{optionsByAttribute:e.optionsByAttribute}}))(Ve),Ge=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).state={optionsCache:a.props.options},a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"render",value:function(){var e=this.props;return r.a.createElement(U.a.Group,{controlId:e.controlId},e.label&&r.a.createElement(U.a.Label,null,e.label),r.a.createElement(U.a.Control,{"data-cy":e.dataCy,defaultValue:e.defaultValue,as:"select",name:e.name,onChange:e.onChange,disabled:e.disabled,onBlur:e.onBlur},e.placeholder&&r.a.createElement("option",{value:"",disabled:!0},e.error?"No se pudo obtener los elementos":e.placeholder),!e.error&&e.options.map((function(t,a){return r.a.createElement("option",{value:e.value?t[e.value]:t,key:a},e.field?t[e.field]:t)}))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){if(t.optionsCache.length>e.options.length)return e.onPropsChangeLess&&(e.onPropsChangeLess(),document.querySelector("#"+e.controlId).value=""),{optionsCache:e.options};if(t.optionsCache.length<e.options.length){if(e.onPropsChangeMore){var a=0;a=e.value?e.options[e.options.length-1][e.value]:e.options[e.options.length-1],document.querySelector("#"+e.controlId).value=a,e.onPropsChangeMore(a)}return{optionsCache:e.options}}return null}}]),t}(n.Component),qe=function(e){function t(){return Object(H.a)(this,t),Object(Y.a)(this,Object(Q.a)(t).apply(this,arguments))}return Object(W.a)(t,e),Object(X.a)(t,[{key:"componentDidMount",value:function(){this.getElements()}},{key:"getElements",value:function(){var e=Object(K.a)(q.a.mark((function e(){var t,a,n,r,i,o;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,a=t.dispatch,n=t.optionsByAttribute,r=t.attribute,i=t.authorized,n[r]){e.next=21;break}if(e.prev=2,a(p(r)),o=null,!i){e.next=11;break}return e.next=8,fe.authorizedGetRequest(this.props.uri);case 8:o=e.sent,e.next=14;break;case 11:return e.next=13,fe.publicGetRequest(this.props.uri);case 13:o=e.sent;case 14:o.error_code?a(h(r)):a(f(r,o.results)),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(2),a(h(r)),console.error(e.t0);case 21:case"end":return e.stop()}}),e,this,[[2,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props,t=e.optionsByAttribute,a=e.attribute;return r.a.createElement("div",null,t[a]&&t[a].isFetching&&r.a.createElement(z,null),t[a]&&!t[a].isFetching&&t[a].items!==[]&&r.a.createElement(Ge,{error:t[a].error,controlId:this.props.controlId,label:this.props.label,name:this.props.name,options:t[a].items,defaultValue:this.props.defaultValue,value:"id",field:"nombre",placeholder:this.props.placeholder,onPropsChangeMore:this.props.onPropsChangeMore,onChange:this.props.onChange,onBlur:this.props.onBlur}))}}]),t}(n.Component);var Ke=Object(s.b)((function(e){return{optionsByAttribute:e.optionsByAttribute}}))(qe),He=function(e){return r.a.createElement(Le.a,{initialValues:{nombre:"",objetivo:"",idioma:"",tipoPlanificacion:"",dominio:"",estado:"",codigo:re()},validator:function(){return{}},validate:function(e){var t={};return e.nombre||(t.nombre="Falta nombre"),e.objetivo||(t.objetivo="Falta objetivo"),e.idioma||(t.idioma="Falta idioma"),e.tipoPlanificacion||(t.tipoPlanificacion="Falta tipo de planificaci\xf3n"),e.dominio||(t.dominio="Falta dominio"),e.estado||(t.estado="Falta estado"),t},onSubmit:function(t,a){(0,a.setSubmitting)(!1),e.onSubmit(t)}},(function(t){var a=t.values,n=t.errors,i=t.touched,o=t.handleChange,c=t.handleBlur,s=t.submitForm,l=t.isSubmitting;return r.a.createElement(U.a,null,r.a.createElement(U.a.Row,null,r.a.createElement(Ie.a,null,r.a.createElement(Fe,{controlId:"formNombre",label:"Nombre",name:"nombre",type:"text",placeholder:"Nombre",onChange:o,onBlur:c,value:a.nombre}),n.nombre&&i.nombre&&n.nombre&&r.a.createElement(U.a.Text,{className:"text-danger",style:{marginTop:"-1em"}},n.nombre)),r.a.createElement(Ie.a,null,r.a.createElement(Fe,{controlId:"formObjetivo",label:"Objetivo",name:"objetivo",type:"text",placeholder:"Objetivo",onChange:o,onBlur:c,value:a.objetivo}),n.objetivo&&i.objetivo&&n.objetivo&&r.a.createElement(U.a.Text,{className:"text-danger",style:{marginTop:"-1em"}},n.objetivo))),r.a.createElement(U.a.Row,null,r.a.createElement(Ie.a,null,r.a.createElement(Ke,{uri:"/idiomas",attribute:"idioma",controlId:"formIdioma",label:"Idioma",name:"idioma",defaultValue:"",placeholder:"Eleg\xed un idioma",onChange:o,onBlur:c}),n.idioma&&i.idioma&&n.idioma&&r.a.createElement(U.a.Text,{className:"text-danger",style:{marginTop:"-1em"}},n.idioma)),r.a.createElement(Ie.a,null,r.a.createElement(Ke,{uri:"/tipos-planificacion",attribute:"tipo-planificacion",controlId:"formTipoPlanificacion",label:"Tipo de planificaci\xf3n",name:"tipoPlanificacion",defaultValue:"",placeholder:"Eleg\xed un tipo",onChange:o,onBlur:c}),n.tipoPlanificacion&&i.tipoPlanificacion&&n.tipoPlanificacion&&r.a.createElement(U.a.Text,{className:"text-danger",style:{marginTop:"-1em"}},n.tipoPlanificacion))),r.a.createElement(U.a.Row,null,r.a.createElement(Ie.a,null,r.a.createElement(Ke,{uri:"/dominios",attribute:"dominio",controlId:"formDominio",label:"Dominio",name:"dominio",defaultValue:e.dominioDefaultValue,placeholder:"Eleg\xed un dominio",onChange:o,onBlur:c}),n.dominio&&i.dominio&&n.dominio&&r.a.createElement(U.a.Text,{className:"text-danger",style:{marginTop:"-1em"}},n.dominio)),r.a.createElement(Ie.a,null,r.a.createElement(Ke,{uri:"/estados",attribute:"estado",controlId:"formEstado",label:"Estado",name:"estado",defaultValue:"",placeholder:"Eleg\xed un estado",onChange:o,onBlur:c}),n.estado&&i.estado&&n.estado&&r.a.createElement(U.a.Text,{className:"text-danger",style:{marginTop:"-1em"}},n.estado))),r.a.createElement(U.a.Row,null,r.a.createElement(ze,null),r.a.createElement(Ie.a,null)),e.error&&r.a.createElement(U.a.Text,{className:"text-danger",style:{marginTop:"-1em"}},e.errorMessage),e.isLoading?r.a.createElement(B.a,{variant:"info",disabled:!0},r.a.createElement(V.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),"Cargando..."):e.success?r.a.createElement(D.b,{to:"/actividad/"+e.actividadId},r.a.createElement(B.a,{variant:"primary",type:"button"},"Continuar")):r.a.createElement(B.a,{variant:"info",onClick:s,disabled:l},"Guardar"))}))},Xe=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).state={isLoading:!1,success:!1,error:!1,errorMessage:""},a.handleFormSubmit=a.handleFormSubmit.bind(Object(J.a)(a)),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"handleFormSubmit",value:function(){var e=Object(K.a)(q.a.mark((function e(t){var a,n,r,i,o,c,s,l;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.nombre,n=t.objetivo,r=t.idioma,i=t.tipoPlanificacion,o=t.dominio,c=t.estado,s=t.codigo,this.setState({isLoading:!0,error:!1,errorMessage:""}),e.next=4,fe.createActividad({nombre:a,objetivo:n,codigo:s,dominio:o,idioma:r,tipoPlanificacion:i,estado:c});case 4:if(!(l=e.sent).error_code){e.next=8;break}return this.setState({isLoading:!1,error:!0,errorMessage:l.user_message}),e.abrupt("return");case 8:this.setState({success:!0,isLoading:!1,error:!1,errorMessage:""}),this.props.dispatch(E(l));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(He,{onChange:this.handleInput,dominioDefaultValue:this.props.currentDominioId,error:this.state.error,errorMessage:this.state.errorMessage,isLoading:this.state.isLoading,success:this.state.success,actividadId:this.props.currentActividad.id,onSubmit:this.handleFormSubmit})}}]),t}(n.Component);var Ye=Object(s.b)((function(e){var t=e.actividad;return{currentActividad:t.currentActividad,currentDominioId:t.currentDominioId}}))(Xe),Qe=function(e){var t=e.match.params;return r.a.createElement(F.a,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement("h2",null,t.id?"Editar":"Crear"," actividad"))),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,{style:{border:"1px solid black",padding:"2em"}},r.a.createElement(Ye,null))))};var Je=function(e){return r.a.createElement("div",null,r.a.createElement("h3",null,"Buscar Tarea"),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement(Ge,{controlId:"searchCriteria",name:"searchCriteria",options:[{id:"1",nombre:"Por autor"},{id:"2",nombre:"Por nombre"},{id:"3",nombre:"Por dominio"}],defaultValue:"",value:"id",field:"nombre",placeholder:"Eleg\xed un criterio",onChange:e.onChange})),r.a.createElement(Ie.a,null,function(e){switch(e){case"1":return r.a.createElement(Fe,{type:"text",placeholder:"Autor"});case"2":return r.a.createElement(Fe,{type:"text",placeholder:"Nombre"});case"3":return r.a.createElement(Ke,{uri:"/dominios",attribute:"dominio",controlId:"formDominio",name:"dominio",defaultValue:"",placeholder:"Eleg\xed un dominio"});default:return r.a.createElement(Ue.a,{type:"text",placeholder:"Eleg\xed un criterio primero",disabled:!0})}}(e.criterionId))))},We=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).onChange=function(e){a.setState({criterionId:e.target.value})},a.state={criterionId:""},a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"render",value:function(){return r.a.createElement(Je,{onChange:this.onChange,criterionId:this.state.criterionId})}}]),t}(n.Component),Ze=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("h2",null,"Mis tareas"," ",r.a.createElement(D.b,{to:"/actividad/"+e.actividadId+"/nuevaTarea"},r.a.createElement(B.a,{variant:"success",type:"button"},"Nueva"))),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement(Ke,{uri:"/tareas/user",authorized:!0,attribute:"tarea",controlId:"formTarea",label:"",name:"tarea",defaultValue:"",placeholder:"Eleg\xed una tarea",onChange:e.onChange})),r.a.createElement(Ie.a,{sm:2},r.a.createElement("span",null,r.a.createElement(B.a,{className:"float-left",variant:"info",type:"button",onClick:e.onClick,disabled:""===e.selectedTarea.id||e.disabled},"Agregar"))),r.a.createElement(Ie.a,null,"Consigna:",r.a.createElement("br",null),e.selectedTarea&&r.a.createElement("span",null,e.selectedTarea.consigna))))},$e=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).state={selectedTarea:{nombre:"",id:""},tareasCache:{}},a.onClick=a.onClick.bind(Object(J.a)(a)),a.onChange=a.onChange.bind(Object(J.a)(a)),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"onChange",value:function(){var e=Object(K.a)(q.a.mark((function e(t){var a,n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=this.state.tareasCache[t.target.value])){e.next=5;break}this.setState({selectedTarea:a}),e.next=9;break;case 5:return e.next=7,fe.getTarea(t.target.value);case 7:(a=e.sent).error_code||((n=this.state.tareasCache)[a.id]=a,this.setState({selectedTarea:a,tareasCache:n}));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onClick",value:function(e){""!==this.state.selectedTarea.id&&this.props.dispatch(b(this.state.selectedTarea))}},{key:"render",value:function(){return r.a.createElement(Ze,{actividadId:this.props.actividadId,onChange:this.onChange,onClick:this.onClick,selectedTarea:this.state.selectedTarea,disabled:""===this.state.selectedTarea.id||!!this.props.clone&&this.props.disabled})}}]),t}(n.Component);var et=Object(s.b)((function(e){return{currentActividad:e.actividad.currentActividad}}))($e),tt=function(e){function t(){return Object(H.a)(this,t),Object(Y.a)(this,Object(Q.a)(t).apply(this,arguments))}return Object(W.a)(t,e),Object(X.a)(t,[{key:"render",value:function(){return r.a.createElement("ul",null,this.props.remainingTareas.map((function(e,t){return r.a.createElement("li",{key:t},'Reemplazar la tarea "',e.nombre,'"')})))}}]),t}(n.Component),at=a(136),nt=a(84),rt=a(35),it=a(36);var ot=function(e){return r.a.createElement(r.a.Fragment,null,e.label&&r.a.createElement("p",null,r.a.createElement("i",null,e.label)),e.items.map((function(t){return r.a.createElement(nt.a,{style:{marginLeft:"1em"},key:(e.value?t[e.value]:t)+"-"+e.group},r.a.createElement(it.a,null,r.a.createElement(rt.a,{type:"checkbox",onChange:e.onChange,name:(e.value?t[e.value]:t)+"-"+e.group}),e.field?t[e.field]:t))})))};var ct=function(e){return r.a.createElement(at.a,{"data-cy":e.dataCy},e.items.map((function(t){return r.a.createElement(at.a.Item,{key:(e.value?t[e.value]:t)+(e.group?"-"+e.group:"")},e.input?r.a.createElement(U.a.Group,{as:_e.a,controlId:(e.value?t[e.value]:t)+(e.group?"-"+e.group:"")},r.a.createElement(U.a.Label,{column:!0,sm:3},e.field?t[e.field]:t),r.a.createElement(Ie.a,{sm:9},r.a.createElement(U.a.Control,{type:e.input.type,placeholder:e.input.placeholder,onChange:e.input.onChange,name:(e.value?t[e.value]:t)+(e.group?"-"+e.group:"")}))):e.field?t[e.field]:t,e.select&&r.a.createElement(Ge,{options:e.select.options,field:e.select.field,placeholder:e.select.placeholder,defaultValue:e.select.defaultValue,name:e.value?t[e.value]:t,onChange:e.select.onChange}),e.checkboxGroup&&r.a.createElement(ot,{items:e.checkboxGroup.items,onChange:e.checkboxGroup.onChange,field:e.checkboxGroup.field,value:e.checkboxGroup.value,label:e.checkboxGroup.label,group:e.value?t[e.value]:t}),e.action&&r.a.createElement(B.a,{variant:"danger",type:"button",className:"float-right",onClick:function(){return e.onClick(t,e.group)},"data-cy":"quitar_"+(e.group?e.group+"_":"")+(t.id||t.name||t)},"Quitar"))})))},st=function(e){return r.a.createElement("div",null,r.a.createElement("h3",null,"Tareas de la actividad ",e.clone&&"(".concat(e.remainingTareas.length," m\xe1s)")),r.a.createElement(ct,{items:e.chosenTareas,action:!0,onClick:e.onClick,field:"nombre",value:"id"}))},lt=function(e){function t(){var e,a;Object(H.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(Y.a)(this,(e=Object(Q.a)(t)).call.apply(e,[this].concat(r)))).onClick=function(e){a.props.dispatch(v(e.id))},a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"render",value:function(){var e=this.props.clonedTareas,t=[];return t=this.props.clone?this.props.chosenTareas.map((function(t,a){return Object(m.a)({},t,{nombre:"Reemplazando a la tarea ".concat(e[a].nombre,": ").concat(t.nombre)})})):this.props.chosenTareas,r.a.createElement(st,{clone:this.props.clone,remainingTareas:this.props.remainingTareas,chosenTareas:t,onClick:this.onClick})}}]),t}(n.Component);var ut=Object(s.b)((function(e){return{chosenTareas:e.actividadTareas.chosenTareas}}))(lt),dt=function(e){return r.a.createElement(r.a.Fragment,null,e.error&&r.a.createElement(U.a.Text,{className:"text-danger"},e.errorMessage),e.isLoading?r.a.createElement(B.a,{variant:"info",disabled:!0},r.a.createElement(V.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),"Cargando..."):e.success?r.a.createElement(D.b,{to:"/actividad/"+e.actividadId+"/planificacion"},r.a.createElement(B.a,{variant:"primary",type:"button",style:{marginTop:"1em"}},"Continuar")):r.a.createElement(B.a,{variant:"info",type:"button",disabled:e.success,onClick:e.onSubmit},"Guardar"))},mt=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).state={isLoading:!1,success:!1,error:!1,errorMessage:""},a.handleFormSubmit=a.handleFormSubmit.bind(Object(J.a)(a)),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"setTareasToActividad",value:function(){var e=Object(K.a)(q.a.mark((function e(t,a){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoading:!0}),e.next=3,fe.setTareasToActividad({tareas:a},t);case 3:if(!(n=e.sent).error_code){e.next=9;break}return this.setState({error:!0,errorMessage:n.user_message,success:!1,isLoading:!1}),e.abrupt("return");case 9:this.setState({success:!0,isLoading:!1});case 10:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"handleFormSubmit",value:function(){var e=Object(K.a)(q.a.mark((function e(){var t,a;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.actividadId,0!==(a=this.props.chosenTareas.map((function(e){return e.id}))).length){e.next=5;break}return this.setState({error:!0,errorMessage:"No se eligieron tareas"}),e.abrupt("return");case 5:this.setTareasToActividad(t,a);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(dt,{isLoading:this.state.isLoading,success:this.state.success,actividadId:this.props.actividadId,onSubmit:this.handleFormSubmit,error:this.state.error,errorMessage:this.state.errorMessage})}}]),t}(n.Component);var ht=Object(s.b)((function(e){return{chosenTareas:e.actividadTareas.chosenTareas}}))(mt),pt=a(93),ft=n.createElement("symbol",{viewBox:"0 0 154 154",width:"154",height:"154",id:"emptyNode"},n.createElement("circle",{cx:"77",cy:"77",r:"56"})),vt=n.createElement("symbol",{viewBox:"0 0 154 154",width:"154",height:"154",id:"optionalEmptyNode",fill:"#ebebe0"},n.createElement("circle",{cx:"77",cy:"77",r:"56"})),bt=n.createElement("symbol",{viewBox:"0 0 160 160",width:"160",height:"160",id:"start"},n.createElement("circle",{cx:"77",cy:"77",r:"56",stroke:"green",strokeWidth:"3px"})),Et=n.createElement("symbol",{viewBox:"0 0 160 160",width:"160",height:"160",id:"optionalStart"},n.createElement("circle",{cx:"77",cy:"77",r:"56",stroke:"green",strokeWidth:"3px",fill:"#ebebe0"})),gt=n.createElement("symbol",{viewBox:"0 0 160 160",width:"160",height:"160",id:"end"},n.createElement("circle",{cx:"77",cy:"77",r:"56",stroke:"red",strokeWidth:"3px"})),Ct=n.createElement("symbol",{viewBox:"0 0 160 160",width:"160",height:"160",id:"optionalEnd",fill:"#ebebe0"},n.createElement("circle",{cx:"77",cy:"77",r:"56",stroke:"red",strokeWidth:"3px"})),kt={EdgeTypes:{emptyEdge:{shape:n.createElement("symbol",{viewBox:"0 0 50 50",id:"emptyEdge"},n.createElement("circle",{cx:"25",cy:"25",r:"8",fill:"currentColor"})),shapeId:"#emptyEdge"},squareEdge:{shape:n.createElement("symbol",{viewBox:"0 0 50 50",id:"squareEdge"},n.createElement("rect",{x:"10",y:"17",width:"15",height:"15",fill:"currentColor"})),shapeId:"#squareEdge"}},NodeSubtypes:{},NodeTypes:{emptyNode:{shape:ft,shapeId:"#emptyNode",typeText:"Tarea"},optionalEmptyNode:{shape:vt,shapeId:"#optionalEmptyNode",typeText:"Tarea"},start:{shape:bt,shapeId:"#start",typeText:"Inicio"},optionalStart:{shape:Et,shapeId:"#optionalStart",typeText:"Inicio"},end:{shape:gt,shapeId:"#end",typeText:"Fin"},optionalEnd:{shape:Ct,shapeId:"#optionalEnd",typeText:"Fin"}}};var yt=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).onUpdateNode=function(){},a.onSelectNode=function(e){null!=e&&a.props.onClickNode(e.id)},a.onSelectEdge=function(e){null!=e&&a.props.onClickEdge(e.id)},a.onCreateNode=function(){},a.onDeleteNode=function(){},a.onConnect=function(){},a.onCreateEdge=function(){},a.onSwapEdge=function(){},a.onDeleteEdge=function(){},a.state={layoutEngineType:"HorizontalTree",selected:null,graph:{nodes:[],edges:[]}},a.GraphView=n.createRef(),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"getNodeIndex",value:function(e){return this.state.graph.nodes.findIndex((function(t){return t.id===e.id}))}},{key:"getEdgeIndex",value:function(e){return this.state.graph.edges.findIndex((function(t){return t.source===e.source&&t.target===e.target}))}},{key:"getViewNode",value:function(e){var t={};t.id=e;var a=this.getNodeIndex(t);return this.state.graph.nodes[a]}},{key:"render",value:function(){var e=this,t=this.state.graph,a=t.nodes,r=t.edges,i=this.state.selected,o=kt.NodeTypes,c=kt.NodeSubtypes,s=kt.EdgeTypes;return n.createElement("div",{id:"graph","data-cy":this.props.dataCy,style:{height:"26em"}},n.createElement(pt.GraphView,{ref:function(t){return e.GraphView=t},nodeKey:"id",nodes:a,edges:r,selected:i,nodeTypes:o,nodeSubtypes:c,edgeTypes:s,onSelectNode:this.onSelectNode,onCreateNode:this.onCreateNode,onUpdateNode:this.onUpdateNode,onDeleteNode:this.onDeleteNode,onSelectEdge:this.onSelectEdge,onCreateEdge:this.onCreateEdge,onSwapEdge:this.onSwapEdge,onDeleteEdge:this.onDeleteEdge,HorizontalTree:!0,onUndo:this.onUndo,onCopySelected:this.onCopySelected,onPasteSelected:this.onPasteSelected,layoutEngineType:this.state.layoutEngineType}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a=e.tareas,n=e.conexiones,r=t.graph.nodes,i=t.graph.edges;if(a.filter((function(e){return e.optional})).length!==r.filter((function(e){return e.optional}))||a.length!==r.length||n.length!==i.length){var o=function(e){return{edges:[],nodes:e.map((function(e,t){return{id:e.id,title:e.graphId,optional:e.optional,initial:e.initial,type:e.optional?"optionalStart":"start"}}))}}(a),c=o.nodes.map((function(e){var t=r.findIndex((function(t){return e.id===t.id}));return-1===t?Object(m.a)({},e,{x:-50,y:100+150*(e.title-1)}):Object(m.a)({},r[t],{optional:e.optional,initial:e.initial,x:-50,y:100+150*(e.title-1)})})),s=n.map((function(e){return{source:e.origen,target:e.destino,on:e.condicion,answer:e.respuesta,type:e.condicion?"squareEdge":"emptyEdge",id:e.id}})),l=c.map((function(e){return e.id}));return o.edges=s.filter((function(e){return l.includes(e.source)&&l.includes(e.target)})),o.nodes=function(e,t){var a=t.map((function(e){return e.target})),n=t.map((function(e){return e.source}));return e.map((function(e){return a.includes(e.id)?n.includes(e.id)?Object(m.a)({},e,{type:e.optional?e.initial?"optionalStart":"optionalEmpty":e.initial?"start":"customEmpty"}):Object(m.a)({},e,{type:e.optional?e.initial?"optionalStart":"optionalEnd":e.initial?"start":"end"}):Object(m.a)({},e,{type:e.optional?"optionalStart":"start"})}))}(c,o.edges),{graph:o}}return null}}]),t}(n.Component),Ot=a(41),Tt=a.n(Ot),xt=function(e){function t(){var e;return Object(H.a)(this,t),(e=Object(Y.a)(this,Object(Q.a)(t).call(this))).state={tareas:[],conexiones:[]},e.loadTareas=e.loadTareas.bind(Object(J.a)(e)),e}return Object(W.a)(t,e),Object(X.a)(t,[{key:"componentDidMount",value:function(){this.loadTareas()}},{key:"loadTareas",value:function(){var e=Object(K.a)(q.a.mark((function e(){var t,a,n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.getTareasForActividad(this.props.actividadId);case 2:if(!(t=e.sent).error_code){e.next=5;break}return e.abrupt("return");case 5:return a=[],e.next=8,fe.getPlanificacionForActividad(this.props.actividadId);case 8:if(!(n=e.sent).error_code){e.next=12;break}return this.setState({errors:!0,errorMessage:n.user_message}),e.abrupt("return");case 12:n.saltos.forEach((function(e){var n=e.origen_id;e.destino_ids.forEach((function(r){var i={origen:n,destino:r,id:Tt()(n+"_"+r+(e.condicion?"_"+e.condicion+"_"+e.respuesta:""))};if(e.respuesta){var o=me.find((function(t){return t.code===e.condicion})).name;if(i.condicion={code:e.condicion,name:o},["YES","NO"].includes(e.condicion)){var c=t.results.find((function(t){return t.id===e.origen_id})).extra.elements.find((function(t){return t.code===e.respuesta})).name;i.respuesta={id:e.respuesta,name:c}}else{var s=t.results.find((function(t){return t.codigo===e.respuesta})).nombre;i.respuesta={id:e.respuesta,name:s}}}a.push(i)}))})),this.setState({conexiones:a,tareas:t.results.map((function(e,t){return Object(m.a)({},e,{nombre:t+1+". "+e.nombre,graphId:t+1,optional:n.opcionales_ids.find((function(t){return t===e.id})),initial:n.iniciales_ids.find((function(t){return t===e.id}))})}))});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.tareas,a=e.conexiones;return a&&r.a.createElement(yt,{dataCy:"graphShow",tareas:t,conexiones:a,onClickNode:function(){}})}}]),t}(n.Component),jt=function(e){function t(){var e;return Object(H.a)(this,t),(e=Object(Y.a)(this,Object(Q.a)(t).call(this))).remainingTareas=function(){return e.state.clonedTareas.filter((function(t,a){return a>=e.props.chosenTareas.length}))},e.state={actividad:null,clonedTareas:[]},e.getActividad=e.getActividad.bind(Object(J.a)(e)),e.getClonedTareas=e.getClonedTareas.bind(Object(J.a)(e)),e}return Object(W.a)(t,e),Object(X.a)(t,[{key:"getActividad",value:function(){var e=Object(K.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.getActividad(this.props.actividadId);case 2:if(!(t=e.sent).error_code){e.next=5;break}return e.abrupt("return");case 5:this.setState({actividad:t});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getClonedTareas",value:function(){var e=Object(K.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.getTareasForActividad(this.props.clone);case 2:if(!(t=e.sent).error_code){e.next=5;break}return e.abrupt("return");case 5:this.setState({clonedTareas:t.results});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.getActividad(),this.props.clone&&this.getClonedTareas()}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(We,null),r.a.createElement(et,{actividadId:this.state.actividad?this.props.actividadId:null,clone:this.props.clone,disabled:this.props.chosenTareas.length===this.state.clonedTareas.length}),r.a.createElement(ut,{clone:this.props.clone,clonedTareas:this.state.clonedTareas,remainingTareas:this.remainingTareas()}),this.props.clone&&r.a.createElement(tt,{remainingTareas:this.remainingTareas()}),this.state.actividad&&r.a.createElement(ht,{actividadId:this.state.actividad.id,clone:this.props.clone}),this.props.clone&&r.a.createElement(xt,{actividadId:this.props.clone}))}}]),t}(n.Component);var St=Object(s.b)((function(e){return{chosenTareas:e.actividadTareas.chosenTareas}}))(jt);function At(e){return $.a.parse(e).clone||!1}var _t=function(e){var t=e.match.params,a=e.location.search;return r.a.createElement(F.a,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement("h2",null,"Elegir tareas ",At(a)&&"(clonando actividad)"))),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,{style:{border:"1px solid black",padding:"2em"}},r.a.createElement(St,{actividadId:t.id,clone:At(a)}))))},It=function(e){return r.a.createElement(Ie.a,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,"Elementos",r.a.createElement(Me.a,{className:"mb-3"},r.a.createElement(Ue.a,{type:"text",value:e.elementName,placeholder:"Nuevo elemento","data-cy":"formOption",onChange:e.onChange,onKeyPress:e.onKeyPress}),r.a.createElement(Me.a.Append,null,r.a.createElement(B.a,{variant:"success",disabled:""===e.elementName,type:"button","data-cy":"buttonAgregarOption",onClick:e.onClick},"Agregar"))))))},wt=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).state={elementName:""},a.handleChange=a.handleChange.bind(Object(J.a)(a)),a.onClick=a.onClick.bind(Object(J.a)(a)),a.onKeyPress=a.onKeyPress.bind(Object(J.a)(a)),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"handleChange",value:function(e){this.setState({elementName:e.target.value})}},{key:"onClick",value:function(e){e.preventDefault();var t={name:this.state.elementName,code:re()};this.props.dispatch(function(e){return{type:"ADD_ELEMENT_TO_EXTRA",element:e}}(t)),this.setState({elementName:""})}},{key:"onKeyPress",value:function(e){"Enter"===e.key&&""!==this.state.elementName&&this.onClick(e)}},{key:"render",value:function(){return r.a.createElement(It,{elementName:this.state.elementName,onChange:this.handleChange,onKeyPress:this.onKeyPress,onClick:this.onClick})}}]),t}(n.Component);var Rt=Object(s.b)((function(e){return{optionsByAttribute:e.optionsByAttribute}}))(wt),Nt=function(e){var t=e.elements;return r.a.createElement("div",null,r.a.createElement("h4",null,"Elegir una opci\xf3n"),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement(ct,{items:t,field:"name",value:"code",action:!0,onClick:e.onClick})),r.a.createElement(Ie.a,null)),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement(Rt,null)),r.a.createElement(Ie.a,null)))},Pt=function(e){function t(){var e,a;Object(H.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(Y.a)(this,(e=Object(Q.a)(t)).call.apply(e,[this].concat(r)))).onClick=function(e){a.props.dispatch(g(e))},a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"render",value:function(){var e=this.props.elements;return r.a.createElement(Nt,{elements:e,onClick:this.onClick})}}]),t}(n.Component);var Dt=Object(s.b)((function(e){return{elements:e.tareaExtra.elements}}))(Pt),Lt=function(e){return r.a.createElement(Me.a,null,r.a.createElement(Ge,{defaultValue:"",placeholder:"Eleg\xed un elemento",options:e.options,onChange:e.onChange,onPropsChangeLess:e.onPropsChangeLess,value:"code",field:"name",controlId:"valids-select"}),r.a.createElement("span",null,r.a.createElement(B.a,{variant:"info",type:"button","data-cy":"buttonAgregarValid",onClick:e.onClick,disabled:e.disabled},"Agregar")))},Ft=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).onClick=function(){""!==a.state.selectedElementId&&a.props.dispatch({type:"ADD_VALID_ELEMENT_TO_EXTRA",element:a.state.selectedElementId})},a.onChange=function(e){a.setState({selectedElementId:e.target.value})},a.onPropsChangeLess=function(){a.setState({selectedElementId:""})},a.state={selectedElementId:""},a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"render",value:function(){return r.a.createElement(Lt,{options:this.props.elements,onChange:this.onChange,onPropsChangeLess:this.onPropsChangeLess,onClick:this.onClick,disabled:""===this.state.selectedElementId})}}]),t}(n.Component);var Mt=Object(s.b)((function(e){return{elements:e.tareaExtra.elements}}))(Ft),Ut=function(e){var t=e.elements,a=e.validElements,n=e.depositos;return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),e.recoleccion&&0===n.length?r.a.createElement(r.a.Fragment,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,"No hay dep\xf3sitos, agreg\xe1 tareas de dep\xf3sito primero")),r.a.createElement("br",null)):r.a.createElement(r.a.Fragment,null,e.recoleccion&&r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement(nt.a,null,r.a.createElement(U.a.Label,null,"Plano"),r.a.createElement(Ue.a,{name:"images",type:"file","data-cy":"file-input",onChange:e.onChangePlano})))),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,e.recoleccion?r.a.createElement(ct,{dataCy:"elements",items:t,field:"name",value:"code",action:!0,onClick:e.onClickElements,checkboxGroup:{items:n,onChange:e.onChangeChecks,label:"Dep\xf3sitos",field:"nombre",value:"codigo"}}):r.a.createElement(ct,{items:t,field:"name",value:"code",action:!0,onClick:e.onClickElements})),r.a.createElement(Ie.a,null)),r.a.createElement(_e.a,null,r.a.createElement(Rt,null),r.a.createElement(Ie.a,null)),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement(Ie.a,null,r.a.createElement(Me.a,{className:"mb-3"},r.a.createElement(it.a,null,r.a.createElement(rt.a,{type:"checkbox","data-cy":"validCheckbox",onChange:e.onChangeCheck}),"Indicar elementos v\xe1lidos")))),r.a.createElement(Ie.a,null)),e.valid&&r.a.createElement(r.a.Fragment,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement(ct,{dataCy:"actionListValids",items:a.map((function(e){return{code:e,name:t.find((function(t){return t.code===e})).name}})),action:!0,group:"valids",onClick:e.onClickValids,value:"code",field:"name"})),r.a.createElement(Ie.a,null)),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement(Mt,null)),r.a.createElement(Ie.a,null)))))},Bt=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).handleCheck=function(e){a.setState({valid:!a.state.valid})},a.onClickElements=function(e){a.props.dispatch(g(e)),a.props.dispatch(C(e.code))},a.onClickValids=function(e){a.props.dispatch(C(e.code))},a.onChangeChecks=function(e){var t=e.target.name.split("-"),n=t[0],r=t[1];e.target.checked?a.props.dispatch(function(e,t){return{type:"ADD_DEPOSIT_TO_ELEMENT",elementCode:e,depositCode:t}}(r,n)):a.props.dispatch(function(e,t){return{type:"REMOVE_DEPOSIT_FROM_ELEMENT",elementCode:e,depositCode:t}}(r,n))},a.handlePlano=function(e){e.preventDefault();var t=e.target.files[0];t?a.props.dispatch(T(window.URL.createObjectURL(t),t.type)):console.log("no files selected")},a.state={valid:!1},a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"render",value:function(){var e=this.props,t=e.elements,a=e.validElements,n=e.chosenTareas.filter((function(e){return"deposit"===e.tipo.codigo})).map((function(e){return{codigo:e.codigo,nombre:e.nombre}}));return r.a.createElement(Ut,{title:this.props.title,recoleccion:this.props.recoleccion,depositos:n,onChangePlano:this.handlePlano,elements:t,onClickElements:this.onClickElements,onChangeChecks:this.onChangeChecks,onChangeCheck:this.handleCheck,valid:this.state.valid,validElements:a,onClickValids:this.onClickValids})}}]),t}(n.Component);var Vt=Object(s.b)((function(e){var t=e.tareaExtra;return{elements:t.elements,validElements:t.validElements,chosenTareas:e.actividadTareas.chosenTareas}}))(Bt),zt=function(e){return r.a.createElement("div",null,r.a.createElement("h4",null,"Nuevo criterio"),r.a.createElement(Fe,{value:e.nombre,label:"Nombre",placeholder:"Nombre",controlId:"formNombreCriterio",horizontal:!0,name:"nombre",onChange:e.onChange}),r.a.createElement(Fe,{value:e.mensaje,label:"Mensaje",placeholder:"Mensaje",controlId:"formMensajeCriterio",horizontal:!0,name:"mensaje",onChange:e.onChange,onKeyPress:e.onKeyPress}),r.a.createElement(B.a,{type:"button",variant:"success",className:"float-right",onClick:e.onClick,disabled:e.disabled},"Agregar"))},Gt=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).onClick=function(){""!==a.state.nombre&&""!==a.state.mensaje&&(a.props.dispatch({type:"ADD_BYSCORE_CRITERION",criterion:{name:a.state.nombre,message:a.state.mensaje,scores:{}}}),a.setState({nombre:"",mensaje:""}))},a.handleInput=function(e){var t=e.target.value,n=e.target.name;a.setState(Object(u.a)({},n,t))},a.onKeyPress=function(e){"Enter"===e.key&&a.onClick(e)},a.state={nombre:"",mensaje:""},a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"render",value:function(){return r.a.createElement(zt,{nombre:this.state.nombre,onChange:this.handleInput,mensaje:this.state.mensaje,onKeyPress:this.onKeyPress,onClick:this.onClick,disabled:""===this.state.nombre||""===this.state.mensaje})}}]),t}(n.Component);var qt=Object(s.b)((function(e){return{tareaExtra:e.tareaExtra}}))(Gt),Kt=function(e){var t=e.criterios,a=e.elements;return r.a.createElement("div",null,r.a.createElement("h3",null,"Contadores"),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement(Rt,null),r.a.createElement(ct,{dataCy:"opciones",items:a,action:!0,onClick:e.onClick,group:"elements",value:"code",field:"name"})),r.a.createElement(Ie.a,null)),t.map((function(t){return r.a.createElement("div",{key:t.name},r.a.createElement("h4",null,t.name," ",r.a.createElement(B.a,{variant:"danger",onClick:function(a){return e.onClickQuitarLink(a,t)}},"Quitar")),r.a.createElement("i",null,t.message),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement(ct,{dataCy:"contadores",items:a,input:{type:"number",onChange:e.onChange},group:t.name,value:"code",field:"name"})),r.a.createElement(Ie.a,null)))})),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement(qt,null)),r.a.createElement(Ie.a,null)))},Ht=function(e){function t(){var e,a;Object(H.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(Y.a)(this,(e=Object(Q.a)(t)).call.apply(e,[this].concat(r)))).onClick=function(e){a.props.dispatch(g(e)),a.props.dispatch(O(e.code))},a.onClickQuitarLink=function(e,t){e.preventDefault(),a.props.dispatch(k(t))},a.onChange=function(e){e.preventDefault();var t={code:e.target.name.split("-")[0],value:e.target.value},n=e.target.id.split("-")[1];""!==e.target.value&&a.props.dispatch(y(t,n))},a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"render",value:function(){return r.a.createElement(Kt,{criterios:this.props.criterios,onClick:this.onClick,elements:this.props.elements,onClickQuitarLink:this.onClickQuitarLink,onChange:this.onChange})}}]),t}(n.Component);var Xt=Object(s.b)((function(e){var t=e.tareaExtra;return{criterios:t.byScore,elements:t.elements}}))(Ht),Yt=function(e){return r.a.createElement("div",null,r.a.createElement("h4",null,"Dep\xf3sito"),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement(nt.a,null,r.a.createElement(U.a.Label,null,"Plano"),r.a.createElement(Ue.a,{name:"images","data-cy":"file-input",type:"file",onChange:e.handlePlano})))))},Qt=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).state={valid:!1},a.handlePlano=a.handlePlano.bind(Object(J.a)(a)),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"handlePlano",value:function(e){e.preventDefault();var t=e.target.files[0];t?this.props.dispatch(T(window.URL.createObjectURL(t),t.type)):console.log("no files selected")}},{key:"render",value:function(){return r.a.createElement(Yt,{handlePlano:this.handlePlano})}}]),t}(n.Component);var Jt=Object(s.b)((function(e){return{}}))(Qt);var Wt=function(e){switch(e.tipoTarea){case"5":return r.a.createElement(Dt,null);case"6":return r.a.createElement(Vt,{title:"Opci\xf3n m\xfaltiple"});case"7":return r.a.createElement(Xt,null);case"8":return r.a.createElement(Vt,{title:"Recolecci\xf3n",recoleccion:!0});case"9":return r.a.createElement(Jt,null);default:return null}},Zt=function(e){return r.a.createElement(Le.a,{initialValues:{nombre:"",consigna:"",tipo:"",dominio:"",estado:"",codigo:re()},validator:function(){return{}},validate:function(e){var t={};return e.nombre||(t.nombre="Falta nombre"),e.consigna||(t.consigna="Falta consigna"),e.tipo||(t.tipo="Falta tipo de tarea"),e.dominio||(t.dominio="Falta dominio"),e.estado||(t.estado="Falta estado"),t},onSubmit:function(t,a){(0,a.setSubmitting)(!1),e.onSubmit(t)}},(function(t){var a=t.values,n=t.errors,i=t.touched,o=t.handleChange,c=t.handleBlur,s=t.submitForm;t.isSubmitting;return r.a.createElement(U.a,null,r.a.createElement(U.a.Row,null,r.a.createElement(Ie.a,null,r.a.createElement(Fe,{controlId:"formNombre",label:"Nombre",name:"nombre",type:"text",placeholder:"Nombre",onChange:o,onBlur:c,value:a.nombre}),n.nombre&&i.nombre&&n.nombre&&r.a.createElement(U.a.Text,{className:"text-danger",style:{marginTop:"-1em"}},n.nombre)),r.a.createElement(Ie.a,null,r.a.createElement(Fe,{controlId:"formConsigna",label:"Consigna",name:"consigna",type:"text",placeholder:"Consigna",onChange:o,onBlur:c,value:a.consigna}),n.consigna&&i.consigna&&n.consigna&&r.a.createElement(U.a.Text,{className:"text-danger",style:{marginTop:"-1em"}},n.consigna))),r.a.createElement(U.a.Row,null,r.a.createElement(Ie.a,null,r.a.createElement(Ke,{uri:"/tipos-tarea",attribute:"tipo",controlId:"formTipo",label:"Tipo",name:"tipo",defaultValue:"",placeholder:"Eleg\xed un tipo",onChange:o,onBlur:c}),n.tipo&&i.tipo&&n.tipo&&r.a.createElement(U.a.Text,{className:"text-danger",style:{marginTop:"-1em"}},n.tipo)),r.a.createElement(Ie.a,null,r.a.createElement(Ke,{uri:"/estados",attribute:"estado",controlId:"formEstado",label:"Estado",name:"estado",defaultValue:"",placeholder:"Eleg\xed un estado",onChange:o,onBlur:c}),n.estado&&i.estado&&n.estado&&r.a.createElement(U.a.Text,{className:"text-danger",style:{marginTop:"-1em"}},n.estado))),r.a.createElement(U.a.Row,null,r.a.createElement(Ie.a,null,r.a.createElement(Ke,{uri:"/dominios",attribute:"dominio",controlId:"formDominio",label:"Dominio",name:"dominio",defaultValue:"",placeholder:"Eleg\xed un dominio",onChange:o,onBlur:c}),n.dominio&&i.dominio&&n.dominio&&r.a.createElement(U.a.Text,{className:"text-danger",style:{marginTop:"-1em"}},n.dominio)),r.a.createElement(Ie.a,null)),r.a.createElement(U.a.Row,null,r.a.createElement(ze,null),r.a.createElement(Ie.a,null)),r.a.createElement("hr",null),r.a.createElement(Wt,{tipoTarea:a.tipo}),e.error&&r.a.createElement(U.a.Text,{className:"text-danger",style:{marginTop:"-1em"}},e.errorMessage),e.isLoading?r.a.createElement(B.a,{variant:"info",disabled:!0},r.a.createElement(V.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),"Cargando..."):e.success?r.a.createElement(D.b,{to:"/actividad/"+e.actividadId},r.a.createElement(B.a,{variant:"primary",type:"button"},"Continuar")):r.a.createElement(B.a,{variant:"info",type:"button",disabled:e.success,onClick:s},"Guardar"))}))},$t=function(e){function t(e){var a;Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).onPropsChangeMore=function(e){var t=a.state.newTarea;t.dominio=e,a.setState({newTarea:t})},a.state={tarea:null,isLoading:!1,success:!1,error:!1,errorMessage:""};var n=a.props.actividadId;return n&&a.setCurrentActividad(n),a.props.dispatch({type:"CLEAR_TAREA_EXTRA"}),a.handleFormSubmit=a.handleFormSubmit.bind(Object(J.a)(a)),a.handleInput=a.handleInput.bind(Object(J.a)(a)),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"setCurrentActividad",value:function(){var e=Object(K.a)(q.a.mark((function e(t){var a;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.getActividad(t);case 2:if(!(a=e.sent).error_code){e.next=6;break}return this.setState({error:!0,errorMessage:a.user_message}),e.abrupt("return");case 6:this.props.dispatch(E(a));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isEmpty",value:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}},{key:"processExtra",value:function(e,t){switch(t){case"5":return{elements:e.elements};case"6":return{elements:e.elements,validElements:e.validElements};case"7":return{elements:e.elements,byScore:e.byScore};case"8":return{elements:e.elements,validElements:e.validElements}}}},{key:"handleFormSubmit",value:function(){var e=Object(K.a)(q.a.mark((function e(t){var a,n,r,i,o,c,s,l,u,d,m,h,p,f,v,E,g,C=this;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.nombre,n=t.consigna,r=t.tipo,i=t.dominio,o=t.codigo,c=t.estado,s=this.props.extra,this.setState({isLoading:!0,error:!1,errorMessage:""}),!le.includes(r)){e.next=18;break}if(0!==s.elements.length){e.next=7;break}return this.setState({errorMessage:"Faltan elementos",error:!0,isLoading:!1}),e.abrupt("return");case 7:if("7"!==r){e.next=12;break}if(l=!1,s.byScore.forEach((function(e){if(Object.keys(e.scores).length<s.elements.length)return C.setState({isLoading:!1,error:!0,errorMessage:"Falta llenar valores en el criterio "+e.name}),void(l=!0)})),!l){e.next=12;break}return e.abrupt("return");case 12:if("8"!==r){e.next=18;break}if(u=!1,s.elements.forEach((function(e){if(!e.deposits||0===e.deposits.length)return C.setState({isLoading:!1,error:!0,errorMessage:"Hay elementos sin dep\xf3sitos: "+e.name}),void(u=!0)})),s.plano||(u=!0),!u){e.next=18;break}return e.abrupt("return");case 18:if(!de.includes(r)){e.next=22;break}if(s.plano&&s.plano.url){e.next=22;break}return this.setState({isLoading:!1,error:!0,errorMessage:"Falta imagen para el plano"}),e.abrupt("return");case 22:if(d=null,le.includes(r)&&(d=this.processExtra(s,r)),m=this.state.tarea){e.next=34;break}return e.next=28,fe.createTarea({nombre:a,consigna:n,codigo:o,tipo:r,dominio:i,estado:c,extraData:d});case 28:if(!(h=e.sent).error_code){e.next=32;break}return this.setState({isLoading:!1,error:!0,errorMessage:h.user_message}),e.abrupt("return");case 32:this.setState({tarea:h}),m=h;case 34:if(!de.includes(r)){e.next=50;break}return e.next=37,fetch(s.plano.url);case 37:return p=e.sent,e.next=40,p.blob();case 40:return f=e.sent,v=new File([f],o+".png",{type:s.plano.filetype}),(E=new FormData).append("plano",v),e.next=46,fe.addPlanoToTarea(E,m.id);case 46:if(!(g=e.sent).error_code){e.next=50;break}return this.setState({isLoading:!1,error:!0,errorMessage:g.user_message}),e.abrupt("return");case 50:this.props.dispatch(b(m)),this.setState({success:!0,isLoading:!1,error:!1,errorMessage:""});case 52:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleInput",value:function(e){var t=e.target.value,a=e.target.name;"tipo"===a&&this.props.dispatch({type:"CLEAR_TAREA_EXTRA"}),this.setState({newTarea:Object(m.a)({},this.state.newTarea,Object(u.a)({},a,t))})}},{key:"render",value:function(){return r.a.createElement(Zt,{onChange:this.handleInput,onPropsChangeMore:this.onPropsChangeMore,error:this.state.error,errorMessage:this.state.errorMessage,isLoading:this.state.isLoading,success:this.state.success,actividadId:this.props.currentActividad.id,onSubmit:this.handleFormSubmit})}}]),t}(n.Component);var ea=Object(s.b)((function(e){return{currentActividad:e.actividad.currentActividad,extra:e.tareaExtra}}))($t),ta=function(e){var t=e.match.params;return r.a.createElement(F.a,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement("h2",null,t.tareaid?"Editar":"Crear"," tarea"))),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,{style:{border:"1px solid black",padding:"2em"}},r.a.createElement(ea,{actividadId:t.id}))))},aa=function(e){var t=e.items,a=e.uriPrefix;return r.a.createElement("ul",null,t&&t.map((function(e,t){return r.a.createElement(D.b,{key:t,to:a+"/"+e.id+"/mostrar"},r.a.createElement("li",null,e.nombre))})))},na=function(e){var t=e.success,a=e.actividades,n=e.error,i=e.errorMessage;return n?r.a.createElement("span",{className:"text-danger"},i):t&&a.length>0?r.a.createElement(aa,{items:a,uriPrefix:"/actividad"}):"No hay actividades"},ra=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).state={actividades:[],success:!1,error:!1,errorMessage:null},a.getActividades=a.getActividades.bind(Object(J.a)(a)),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"componentDidMount",value:function(){this.getActividades()}},{key:"getActividades",value:function(){var e=Object(K.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.getActividadesPublic();case 2:t=e.sent;try{t.error_code?this.setState({error:!0,errorMessage:"Ocurri\xf3 un error"}):this.setState({actividades:t.results,success:!0})}catch(a){this.setState({error:!0,errorMessage:"Ocurri\xf3 un error"})}case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(na,{actividades:this.state.actividades,success:this.state.success,error:this.state.error,errorMessage:this.state.errorMessage})}}]),t}(n.Component);var ia=Object(s.b)((function(e){return e}))(ra),oa=function(e){return r.a.createElement(F.a,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement("h2",null,"Actividades p\xfablicas"))),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,{style:{border:"1px solid black",padding:"2em"}},r.a.createElement(ia,null))))},ca=function(e){var t=e.success,a=e.actividades;return t&&r.a.createElement(aa,{items:a,uriPrefix:"/actividad"})},sa=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).state={actividades:[],success:!1},a.getActividades=a.getActividades.bind(Object(J.a)(a)),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"componentDidMount",value:function(){this.getActividades()}},{key:"getActividades",value:function(){var e=Object(K.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.getMisActividades();case 2:(t=e.sent).error_code||this.setState({actividades:t.results,success:!0});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(ca,{success:this.state.success,actividades:this.state.actividades})}}]),t}(n.Component);var la=Object(s.b)((function(e){return e}))(sa),ua=function(e){return r.a.createElement(F.a,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement("h2",null,"Mis actividades"))),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,{style:{border:"1px solid black",padding:"2em"}},r.a.createElement(la,null))))};var da=function(e){var t=e.actividad,a=e.tareas,n=e.conexiones,i=e.errors;return r.a.createElement(r.a.Fragment,null,t&&r.a.createElement(r.a.Fragment,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,"Nombre: ",t.nombre)),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,"Objetivo: ",t.objetivo)),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,"Idioma: ",t.idioma.nombre)),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,"Dominio: ",t.dominio.nombre)),r.a.createElement(B.a,{href:se+"/public/actividades/"+t.id+"/data"},"Descargar"),r.a.createElement("hr",null),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement("legend",null,"Tareas"),r.a.createElement("ul",null,a.map((function(e){return r.a.createElement("li",{key:e.id},e.nombre)}))))),n&&r.a.createElement(yt,{dataCy:"graphShow",tareas:a,conexiones:n,onClickNode:function(){}})),i&&r.a.createElement("legend",null,"Actividad no encontrada"))},ma=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).state={actividad:null,tareas:[],errors:!1},a.getActividadAndTareas=a.getActividadAndTareas.bind(Object(J.a)(a)),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"componentDidMount",value:function(){this.getActividadAndTareas()}},{key:"getActividadAndTareas",value:function(){var e=Object(K.a)(q.a.mark((function e(){var t,a,n,r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.getActividadPublic(this.props.actividadId);case 2:if((t=e.sent).error_code){e.next=7;break}this.setState({actividad:t}),e.next=9;break;case 7:return this.setState({errors:!0}),e.abrupt("return");case 9:return e.next=11,fe.getTareasForActividadPublic(t.id);case 11:if(!(a=e.sent).error_code){e.next=15;break}return this.setState({errors:!0}),e.abrupt("return");case 15:return n=[],e.next=18,fe.getPlanificacionForActividadPublic(t.id);case 18:if(!(r=e.sent).error_code){e.next=22;break}return this.setState({errors:!0,errorMessage:r.user_message}),e.abrupt("return");case 22:r.saltos.forEach((function(e){var t=e.origen_id;e.destino_ids.forEach((function(r){var i={origen:t,destino:r,id:Tt()(t+"_"+r+(e.condicion?"_"+e.condicion+"_"+e.respuesta:""))};if(e.respuesta){var o=me.find((function(t){return t.code===e.condicion})).name;if(i.condicion={code:e.condicion,name:o},["YES","NO"].includes(e.condicion)){var c=a.results.find((function(t){return t.id===e.origen_id})).extra.elements.find((function(t){return t.code===e.respuesta})).name;i.respuesta={id:e.respuesta,name:c}}else{var s=a.results.find((function(t){return t.codigo===e.respuesta})).nombre;i.respuesta={id:e.respuesta,name:s}}}n.push(i)}))})),this.setState({conexiones:n,tareas:a.results.map((function(e,t){return Object(m.a)({},e,{nombre:t+1+". "+e.nombre,graphId:t+1,optional:r.opcionales_ids.find((function(t){return t===e.id})),initial:r.iniciales_ids.find((function(t){return t===e.id}))})}))});case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.actividad,a=e.tareas,n=e.conexiones,i=e.errors;return r.a.createElement(da,{actividad:t,tareas:a,errors:i,conexiones:n})}}]),t}(n.Component),ha=function(e){var t=e.match.params;return r.a.createElement(F.a,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement("h2",null,"Actividad"))),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,{style:{border:"1px solid black",padding:"2em"}},r.a.createElement(ma,{actividadId:t.id}))))},pa=a(74),fa=a(131),va=a(135);var ba=function(e){return r.a.createElement(it.a,{style:{marginLeft:"1.25rem"}},r.a.createElement(rt.a,{"data-cy":e.dataCy,type:"checkbox",checked:e.checked,onChange:e.onChange}),r.a.createElement("span",null,e.label))},Ea=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).filterSiguientes=Object(pa.a)((function(e,t){return e.filter((function(e){return e.origen===t}))})),a.findTarea=Object(pa.a)((function(e,t){return t.find((function(t){return t.id===e}))})),a.onInicialChange=function(){var e=a.props.tarea;e.initial=!e.initial,a.props.onUpdateTarea(e)},a.onOptionalChange=function(){var e=a.props.tarea;e.optional=!e.optional,a.props.onUpdateTarea(e)},a.onClickMostrarConexiones=function(){a.setState({showConexiones:!a.state.showConexiones})},a.onCondicionCheckboxChange=function(){a.state.showCondicion||a.setState({agregarConexionDisabled:!0}),a.setState({showCondicion:!a.state.showCondicion})},a.onConexionChange=function(e){var t=e.nativeEvent.target.selectedIndex,n=e.nativeEvent.target[t].text;a.setState({selectedSiguiente:{id:parseInt(e.target.value),name:n},agregarConexionDisabled:!1})},a.onCondicionSelectChange=function(e){var t=e.nativeEvent.target.selectedIndex,n=e.nativeEvent.target[t].text;a.setState({selectedCondition:{code:e.target.value,name:n},agregarConexionDisabled:!0})},a.onAnswerTaskChange=function(e){var t=e.nativeEvent.target.selectedIndex,n=e.nativeEvent.target[t].text;a.setState({selectedAnswerTask:{id:e.target.value,name:n},agregarConexionDisabled:!1})},a.onClickAgregarConexion=function(){var e=a.state.selectedSiguiente;a.state.showCondicion&&(e.condicion=a.state.selectedCondition,e.respuesta=a.state.selectedAnswerTask),e.origen=a.props.tarea.id,e.destino=e.id,e.id=Tt()(e.origen+"_"+e.destino+(e.condicion?"_"+e.condicion+"_"+e.respuesta:"")),a.props.onAddConexion(e),a.props.handleClose()},a.getSelectableTareas=function(){var e=a.filterSiguientes(a.props.conexiones,a.props.tarea.id);return a.props.tareas.filter((function(t){return t.id!==a.props.tarea.id&&-1===e.findIndex((function(e){return e.destino===t.id}))}))},a.tareaHasOptions=function(){return ue.includes(a.props.tarea.tipo.id.toString())},a.getAnswerTaskLabel=function(){if(!a.state.selectedCondition)return"la opci\xf3n/tarea...";switch(a.state.selectedCondition.code){case"YES":case"NO":return"la opci\xf3n";case"YES_TASK":case"NO_TASK":return"la tarea";default:return null}},a.getAnswerTareaSelect=function(){if(!a.state.selectedCondition)return r.a.createElement(Ge,{options:[],defaultValue:"",placeholder:"Elegir..."});switch(a.state.selectedCondition.code){case"YES":case"NO":return r.a.createElement(Ge,{dataCy:"condicionRespuesta",key:a.state.selectedCondition.code,options:a.props.tarea.extra.elements,defaultValue:"",value:"code",field:"name",placeholder:"Elegir...",onChange:a.onAnswerTaskChange});case"YES_TASK":case"NO_TASK":return r.a.createElement(Ge,{dataCy:"condicionTarea",key:a.state.selectedCondition.code,options:a.props.tareas,defaultValue:"",value:"codigo",field:"nombre",placeholder:"Elegir...",onChange:a.onAnswerTaskChange});default:return null}},a.state={showConexiones:!1,showCondicion:!1,selectedSiguiente:null,agregarConexionDisabled:!0,selectedCondition:null,selectedAnswerTask:null},a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"render",value:function(){var e=this.props,t=e.tarea,a=e.show;return r.a.createElement(fa.a,{show:a,onHide:this.props.handleClose,animation:!1,centered:!0},r.a.createElement(fa.a.Header,{closeButton:!0},r.a.createElement(fa.a.Title,null,"Tarea seleccionada: ",t.nombre)),r.a.createElement(fa.a.Body,null,r.a.createElement(va.a,{body:!0},r.a.createElement("p",null,t.consigna),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement(ba,{checked:t.optional,onChange:this.onOptionalChange,label:"Opcional"}),r.a.createElement("br",null),r.a.createElement(ba,{checked:t.initial,onChange:this.onInicialChange,label:"Inicial"})),r.a.createElement(Ie.a,null,this.getSelectableTareas().length>0&&!this.state.showConexiones&&r.a.createElement(B.a,{variant:"primary","data-cy":"agregarConexiones",onClick:this.onClickMostrarConexiones},"Agregar conexiones"))),this.state.showConexiones&&this.getSelectableTareas().length>0&&r.a.createElement(va.a,{body:!0},r.a.createElement("h5",null,"Agregar conexi\xf3n"),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement("span",null,"Hacia la tarea...")),r.a.createElement(Ie.a,null,r.a.createElement(Ge,{options:this.getSelectableTareas(),field:"nombre",value:"id",defaultValue:"",placeholder:"Elegir siguiente",onChange:this.onConexionChange}))),this.state.selectedSiguiente&&r.a.createElement(_e.a,null,r.a.createElement(Ie.a,{md:6},r.a.createElement(ba,{dataCy:"mostrarCondicion",checked:this.state.showCondicion,onChange:this.onCondicionCheckboxChange,label:"Mostrar condici\xf3n"}))),this.state.showCondicion&&r.a.createElement(r.a.Fragment,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,"Cuando..."),r.a.createElement(Ie.a,null,r.a.createElement(Ge,{dataCy:"cuando",options:this.tareaHasOptions()?me:he,defaultValue:"",value:"code",field:"name",placeholder:"Elegir...",onChange:this.onCondicionSelectChange}))),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,this.getAnswerTaskLabel()),r.a.createElement(Ie.a,null,this.state.selectedSiguiente&&this.getAnswerTareaSelect()))),r.a.createElement(B.a,{variant:"success",className:"float-right",disabled:this.state.agregarConexionDisabled,onClick:this.onClickAgregarConexion,"data-cy":"agregarConexion"},"Agregar conexi\xf3n")))))}}]),t}(n.Component);function ga(e,t){return e.find((function(e){return e.id===t}))}var Ca=function(e){var t=e.show,a=e.conexion,n=e.handleClose,i=e.tareas,o=e.onRemoveConexion;return r.a.createElement(fa.a,{show:t,onHide:n,animation:!1,centered:!0},r.a.createElement(fa.a.Header,{closeButton:!0},r.a.createElement(fa.a.Title,null,"Conexi\xf3n")),r.a.createElement(fa.a.Body,null,r.a.createElement(va.a,{body:!0},"Desde la tarea ",r.a.createElement("b",null,'"',ga(i,a.origen).nombre,'"')," hacia la tarea"," ",r.a.createElement("b",null,'"',ga(i,a.destino).nombre,'"'),a.condicion&&r.a.createElement("span",null," ","cuando ",r.a.createElement("b",null,a.condicion.name)," la ",["YES","NO"].includes(a.condicion.code)?"opci\xf3n":"tarea"," ",r.a.createElement("b",null,a.respuesta.name)))),r.a.createElement(fa.a.Footer,null,r.a.createElement(B.a,{variant:"danger",onClick:function(){o(a),n()}},"Quitar conexi\xf3n")))},ka=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("h6",{style:{color:"gray"}},r.a.createElement("i",null,0===e.graphConexiones.length?"Para iniciar la conexi\xf3n entre tareas selecione una tarea incial":"Para conectar dos tareas seleccione una tarea")),r.a.createElement(_e.a,{style:{border:"1px solid black",paddingTop:"2em",paddingBottom:"2em"}},r.a.createElement(Ie.a,null,e.success&&r.a.createElement(yt,{tareas:e.tareas,conexiones:e.conexiones,actividadId:e.actividadId,onClickNode:e.onClickNode,onClickEdge:e.onClickEdge}),e.success&&!e.saveSuccess&&r.a.createElement(B.a,{type:"button",className:"float-right",variant:"info",onClick:e.onGuardarClick},"Guardar"),e.saveSuccess&&r.a.createElement(D.b,{to:"./mostrar"},r.a.createElement(B.a,{type:"button",className:"float-right",variant:"info"},"Continuar")),e.selectedTarea&&r.a.createElement(Ea,{key:e.selectedTarea.id,handleClose:e.handleCloseTarea,show:e.showTarea,tarea:e.selectedTarea,tareas:e.tareas,conexiones:e.conexiones,onUpdateTarea:e.onUpdateTarea,onAddConexion:e.onAddConexion}),e.selectedConexion&&r.a.createElement(Ca,{key:e.selectedConexion.id,handleClose:e.handleCloseConexion,show:e.showConexion,conexion:e.selectedConexion,tareas:e.tareas,onRemoveConexion:e.onRemoveConexion}))))},ya=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).onUpdateTarea=function(e){a.setState({graphTareas:Object(d.a)(a.state.graphTareas.map((function(t){return t.id===e.id?e:t})))})},a.onAddConexion=function(e){a.setState({graphConexiones:[].concat(Object(d.a)(a.state.graphConexiones.filter((function(t){return t.id!==e.id}))),[e])})},a.onResetSaltos=function(e){var t=a.state.graphConexiones.filter((function(t){return t.origen!==e&&t.destino!==e}));a.setState({graphConexiones:Object(d.a)(t)})},a.onRemoveConexion=function(e){var t=a.state.graphConexiones.filter((function(t){return t.id!==e.id}));a.setState({graphConexiones:Object(d.a)(t)})},a.onGuardarClick=function(){var e=a.props.currentActividad.id,t=a.state.graphTareas,n=a.state.graphConexiones,r={};t.forEach((function(e){r[e.id]=[]})),n.forEach((function(e){r[e.origen].push(e)}));var i=[];t.forEach((function(e){return i=i.concat(a.createJumps(e,r))}));var o=a.state.graphTareas.filter((function(e){return e.optional})).map((function(e){return e.id})),c=a.state.graphTareas.filter((function(e){return e.initial})).map((function(e){return e.id})),s=a.state.graphConexiones.map((function(e){return e.destino}));a.state.graphTareas.forEach((function(e){s.includes(e.id)||(c=[].concat(Object(d.a)(c.filter((function(t){return t!==e.id}))),[e.id]))})),a.setPlanificacion(o,c,i,e)&&a.setState({saveSuccess:!0})},a.handleShowTarea=function(e){var t=a.state.graphTareas.find((function(t){return t.id===e}));a.setState({showTarea:!0,selectedTarea:t})},a.handleCloseTarea=function(){a.setState({showTarea:!1,selectedTarea:null})},a.handleShowConexion=function(e){var t=a.state.graphConexiones.find((function(t){return t.id===e}));a.setState({showConexion:!0,selectedConexion:t})},a.handleCloseConexion=function(){a.setState({showConexion:!1,selectedConexion:null})},a.state={success:!1,graphTareas:[],graphConexiones:[],showTarea:!1,showConexion:!1,selectedTarea:null,selectedConexion:null,errors:"",saveSuccess:!1},a.setCurrentActividad(a.props.actividadId),a.Graph=r.a.createRef(),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"setCurrentActividad",value:function(){var e=Object(K.a)(q.a.mark((function e(t){var a,n,r,i,o;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.getActividad(t);case 2:if(!(a=e.sent).error_code){e.next=6;break}return this.setState({error:!0,errorMessage:a.user_message}),e.abrupt("return");case 6:return this.props.dispatch(E(a)),e.next=9,fe.getTareasForActividad(t);case 9:if(n=e.sent,!a.error_code){e.next=13;break}return this.setState({error:!0,errorMessage:a.user_message}),e.abrupt("return");case 13:return r=[],e.next=16,fe.getPlanificacionForActividad(t);case 16:(i=e.sent).saltos.forEach((function(e){var t=e.origen_id;e.destino_ids.forEach((function(a){var i={origen:t,destino:a,id:Tt()(t+"_"+a+(e.condicion?"_"+e.condicion+"_"+e.respuesta:""))};if(e.respuesta){var o=me.find((function(t){return t.code===e.condicion})).name;if(i.condicion={code:e.condicion,name:o},["YES","NO"].includes(e.condicion)){var c=n.results.find((function(t){return t.id===e.origen_id})).extra.elements.find((function(t){return t.code===e.respuesta})).name;i.respuesta={id:e.respuesta,name:c}}else{var s=n.results.find((function(t){return t.codigo===e.respuesta})).nombre;i.respuesta={id:e.respuesta,name:s}}}r.push(i)}))})),o=n.results.map((function(e,t){return Object(m.a)({},e,{nombre:t+1+". "+e.nombre,id:e.id,graphId:t+1,optional:i.opcionales_ids.find((function(t){return t===e.id})),initial:i.iniciales_ids.find((function(t){return t===e.id}))})})),this.setState({graphTareas:o,graphConexiones:r,success:!0});case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createJumps",value:function(e,t){var a=[],n=t[e.id],r=n.filter((function(e){return e.condicion}));console.log(r);var i={};r.forEach((function(e){(i[e.respuesta.id]=i[e.respuesta.id]||[]).push(e)})),Object.keys(i).forEach((function(t){var n={};i[t].forEach((function(e){(n[e.condicion.code]=n[e.condicion.code]||[]).push(e.destino)})),Object.keys(n).forEach((function(r){console.log("salto condicional"),a.push({origen:e.id,condicion:r,destinos:n[r],respuesta:t})}))}));var o=n.filter((function(e){return void 0===e.condicion})).map((function(e){return e.destino}));return console.log(o),o.length>0&&(console.log("salto forzado"),a.push({origen:e.id,condicion:"ALL",destinos:o})),a}},{key:"setPlanificacion",value:function(){var e=Object(K.a)(q.a.mark((function e(t,a,n,r){var i;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.setPlanificacionInActividad({saltos:n,iniciales:a,opcionales:t},r);case 2:if(!(i=e.sent).error_code){e.next=8;break}return this.setState({saveSuccess:!1,errors:i.user_message}),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(ka,{graphConexiones:this.state.graphConexiones,tareas:this.state.graphTareas,conexiones:this.state.graphConexiones,actividadId:this.props.actividadId,selectedTarea:this.state.selectedTarea,handleCloseTarea:this.handleCloseTarea,showTarea:this.handleShowTarea,onClickNode:this.handleShowTarea,onClickEdge:this.handleShowConexion,onUpdateTarea:this.onUpdateTarea,onAddConexion:this.onAddConexion,selectedConexion:this.state.selectedConexion,handleCloseConexion:this.handleCloseConexion,showConexion:this.handleShowConexion,onRemoveConexion:this.onRemoveConexion,success:this.state.success,saveSuccess:this.state.saveSuccess,onGuardarClick:this.onGuardarClick})}}]),t}(n.Component);var Oa=Object(s.b)((function(e){return{currentActividad:e.actividad.currentActividad,chosenTareas:e.actividadTareas.chosenTareas}}))(ya),Ta=function(e){var t=e.match.params;return r.a.createElement(F.a,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement("h2",null,"Planificaci\xf3n de tareas"))),r.a.createElement(Oa,{actividadId:t.id}))},xa=function(e){return e.success&&r.a.createElement(aa,{uriPrefix:"/tarea",items:e.tareas})},ja=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).state={tareas:[],success:!1},a.getTareas=a.getTareas.bind(Object(J.a)(a)),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"componentDidMount",value:function(){this.getTareas()}},{key:"getTareas",value:function(){var e=Object(K.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.getTareasPublic();case 2:(t=e.sent).error_code||this.setState({tareas:t.results,success:!0});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(xa,{success:this.state.success,tareas:this.state.tareas})}}]),t}(n.Component);var Sa=Object(s.b)((function(e){return e}))(ja),Aa=function(e){e.match.params;return r.a.createElement(F.a,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement("h2",null,"Tareas p\xfablicas"))),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,{style:{border:"1px solid black",padding:"2em"}},r.a.createElement(Sa,null))))},_a=function(e){return e.success&&r.a.createElement(aa,{uriPrefix:"/tarea",items:e.tareas})},Ia=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).state={tareas:[],success:!1},a.getTareas=a.getTareas.bind(Object(J.a)(a)),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"componentDidMount",value:function(){this.getTareas()}},{key:"getTareas",value:function(){var e=Object(K.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.getMisTareas();case 2:(t=e.sent).error_code||this.setState({tareas:t.results,success:!0});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(_a,{success:this.state.success,tareas:this.state.tareas})}}]),t}(n.Component);var wa,Ra=Object(s.b)((function(e){return e}))(Ia),Na=function(e){e.match.params;return r.a.createElement(F.a,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement("h2",null,"Mis tareas"))),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,{style:{border:"1px solid black",padding:"2em"}},r.a.createElement(Ra,null))))},Pa=a(130),Da=function(e){var t=e.tarea,a=e.errors;return r.a.createElement(r.a.Fragment,null,t&&r.a.createElement(r.a.Fragment,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,"Nombre: ",t.nombre)),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,"Consigna: ",t.consigna)),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,"Tipo: ",t.tipo.nombre)),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,"Dominio: ",t.dominio.nombre)),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,e.imgSrc&&r.a.createElement(Pa.a,{src:e.imgSrc,style:{width:"30em"}})))),a&&r.a.createElement("legend",null,"Tarea no encontrada"))},La=function(e){function t(e){var a;return Object(H.a)(this,t),(a=Object(Y.a)(this,Object(Q.a)(t).call(this,e))).state={tarea:null,errors:!1},a.getTarea=a.getTarea.bind(Object(J.a)(a)),a.getTarea(),a}return Object(W.a)(t,e),Object(X.a)(t,[{key:"getTarea",value:function(){var e=Object(K.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.getTareaPublic(this.props.actividadId);case 2:(t=e.sent).error_code?this.setState({errors:!0}):this.setState({tarea:t});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=null;return this.state.tarea&&(e=de.includes(this.state.tarea.tipo.id.toString())?"http://localhost:8080/uploads/planos/"+this.state.tarea.codigo+".png":null),r.a.createElement(Da,{tarea:this.state.tarea,errors:this.state.errors,imgSrc:e})}}]),t}(n.Component),Fa=function(e){var t=e.match.params;return r.a.createElement(F.a,null,r.a.createElement(_e.a,null,r.a.createElement(Ie.a,null,r.a.createElement("h2",null,"Tarea"))),r.a.createElement(_e.a,null,r.a.createElement(Ie.a,{style:{border:"1px solid black",padding:"2em"}},r.a.createElement(La,{actividadId:t.id}))))},Ma=(wa=["ROLE_AUTOR"],function(e){return Ee(Object(s.b)(ge)((function(t){return t.isLoading?r.a.createElement("span",null,"Cargando..."):function(e,t){var a=!1;return e.forEach((function(e){t.includes(e)&&(a=!0)})),a}(t.roles,wa)?r.a.createElement(e,t):r.a.createElement(M,null)})))});var Ua=function(){return r.a.createElement(D.a,{basename:"/"},r.a.createElement(je,null),r.a.createElement(F.a,{style:{marginTop:"1em"}},r.a.createElement(L.a,{path:"/",exact:!0,component:Ee(we)}),r.a.createElement(L.a,{path:"/callback",component:De}),r.a.createElement(L.a,{path:"/nuevaActividad",exact:!0,component:Ma(Qe)}),r.a.createElement(L.a,{path:"/actividad/:id",exact:!0,component:Ma(_t)}),r.a.createElement(L.a,{path:"/actividad/:id/nuevaTarea",exact:!0,component:Ma(ta)}),r.a.createElement(L.a,{path:"/nuevaTarea",exact:!0,component:Ma(ta)}),r.a.createElement(L.a,{path:"/actividad/:id/planificacion",exact:!0,component:Ma(Ta)}),r.a.createElement(L.a,{path:"/actividades",exact:!0,component:oa}),r.a.createElement(L.a,{path:"/mis-actividades/",exact:!0,component:Ma(ua)}),r.a.createElement(L.a,{path:"/actividad/:id/mostrar",exact:!0,component:ha}),r.a.createElement(L.a,{path:"/tareas",exact:!0,component:Aa}),r.a.createElement(L.a,{path:"/mis-tareas",exact:!0,component:Ma(Na)}),r.a.createElement(L.a,{path:"/tarea/:id/mostrar",exact:!0,component:Fa})))};var Ba=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||c.c,Va=Object(c.d)(w,Ba());Object(l.loadUser)(Va,P),fe.initialize(Va),fe.loadApiUser(),o.a.render(r.a.createElement(s.a,{store:Va},r.a.createElement(l.OidcProvider,{store:Va,userManager:P},r.a.createElement(Ua,null))),document.getElementById("root"))},96:function(e,t,a){e.exports=a(123)}},[[96,4,0,5]]]);
//# sourceMappingURL=main.1f049718.chunk.js.map